#software-engineering #aposd2e #reading 

讨论创建深模块的技术。

## 信息隐藏

实现深模块最重要的技术之一是 _信息隐藏_。该想法最早是由 David Parnas 在一篇经典的论文 [1](#Refs.) 中提出的。基本思想是每个模块应封装一些知识 [2](#Refs.)，这些知识代表设计决策。该知识嵌入在模块的实现中，但不会出现在其接口中，因此其他模块不可见。

隐藏在模块中的信息通常包含有关如何实现某种机制的详细信息。

隐藏的信息包括与该机制相关的数据结构和算法。它也可以包含较低层级的详细信息，还可以包含更抽象的较高层级的概念。

信息隐藏从两个方面降低了复杂性。首先，它简化了模块的接口。接口以更简单、更抽象的方式反映了模块的功能，并隐藏了细节。这减少了使用该模块的开发人员的认知负荷。其次，信息隐藏使系统更容易扩展。如果隐藏了一段信息，那么在包含该信息的模块之外就不存在对该信息的依赖，因此与该信息相关的设计变更将只影响一个模块。

> 设计新模块时，应仔细考虑可以在该模块中隐藏哪些信息。如果可以隐藏更多信息，您就应该能够简化模块的接口，这会使模块更深。

## 信息泄漏

信息隐藏的反面是信息泄露。当一个设计决策反映在多个模块中时，就会发生 _信息泄露_。这在模块之间创建了依赖关系：对该设计决策的任何更改都将要求对所有涉及的模块进行更改。如果一条信息反映在模块的接口中，根据定义，该信息已经泄露；因此，更简单的接口往往会隐藏更多的信息。

但是，即使信息未出现在模块的接口中，也可能会泄露信息。假设两个类都具有特定文件格式的知识（也许一个类读取该格式的文件，而另一个类写入它们），即使两个类都不在其接口中公开该信息，但它们都依赖于文件格式：如果文件格式被更改，则两个类都将需要修改。像这样的后门泄露比通过接口泄露更为严重，因为它的隐蔽性更强。

> 信息泄露是软件设计中最重要的危险信号之一。当在多个地方使用相同的知识时，就会发生信息泄露。

## 时间顺序分解

_时间顺序分解_ 的设计风格是导致信息泄露的常见原因。在时间顺序分解中，系统的结构对应于操作发生的时间顺序。考虑一个应用程序：它读取特定格式的文件，修改文件内容，然后再次将文件写入。通过时间顺序分解，该应用程序可能被分解为三个类：一个类用于读取文件，另一个类用于执行修改操作，还有一个类用于写入新版本的文件。文件读取和文件写入步骤都有文件格式相关的知识，这会导致信息泄露。解决方案是将用于读写文件的核心机制合并到一个类中，该类将在应用程序的读取和写入阶段使用。因为在编写代码时通常会想到操作的执行顺序, 所以很容易陷入时间顺序分解的陷阱。然而，大多数设计决策会在应用程序的生命周期内的多个不同时间点显现；因此，时间顺序分解经常导致信息泄露。

顺序固然很重要，所以它会在应用程序中有所体现。但是，除非该结构与信息隐藏保持一致（不同执行阶段使用完全不同的信息），否则不应将其反映在模块结构中。**在设计模块时，应专注于执行每个任务所需的知识，而不是任务的执行顺序**。

> 在时间顺序分解中，执行顺序反映在代码结构中：在不同时间发生的操作在不同的方法或类中。如果相同的知识在不同的执行点使用，它会在多个位置被编码，从而导致信息泄露。

---

> 如果一个常用特性的 API 迫使用户了解其他很少使用的特性，这将增加不需要使用这些特性的用户的认知负荷。

## 类内部的信息隐藏

信息隐藏也可以应用于系统中的其他层级，比如类的内部。可以尝试在类中设计私有方法，使得每个方法都封装一些信息或能力，并将其对类的其余部分隐藏。

## 过犹不及

信息隐藏只有在被隐藏的信息在模块外部不需要时才有意义。如果模块外部需要该信息，则不得隐藏它。假设模块的性能受某些配置参数的影响，并且模块的不同用途将需要对参数进行不同的设置。在这种情况下，将参数暴露在模块的接口中很重要，以便可以对其进行适当的调整。

## 结论

信息隐藏和深模块密切相关。如果模块隐藏了很多信息，则往往会增加模块提供的功能，同时还会减少其对外接口数量。这使得模块更深。相反，如果一个模块没有隐藏太多信息，则它要么功能不多，要么接口复杂。无论哪种方式，模块都是浅的。

将系统分解为模块时，请尽量不要受运行时操作顺序的影响，否则您将沿着时间顺序分解的错误道路前进，这将导致信息泄露和浅模块。相反，请考虑执行应用程序的任务所需的不同知识，并在设计每个模块时封装这些知识中的一个或几个。这样将产生一个整洁和简单的深模块设计。

## Refs.

1. David Parnas，“关于将系统分解为模块的标准”，ACM 通讯，1972 年 12 月。
2. 关于知识（knowledge）可以了解“最少知识原则”的设计原则。