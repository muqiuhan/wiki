#distributed

![image.png](https://ucc.alicdn.com/pic/developer-ecology/b0652d61627e4e29b4e373dd1b5073ae.png?x-oss-process=image/resize,s_500,m_lfit "image.png")
​
淘宝按照单元切分的异地多活架构
​
注意看图中的数据同步箭头。以交易单元为例，属于交易单元的业务数据，将与中心单元进行双向同步；不属于交易单元的业务数据，单向从中心单元同步。中心单元承担了最复杂的业务场景，业务单元承担了相对单一的场景。对于业务单元，可以进行弹性伸缩和容灾；对于中心单元，扩展能力较差，稳定性要求更高。可以遇见，大部分的故障都会出现在中心单元。
​
按照业务进行单元切分，已经需要对代码和架构进行彻底的改造了（可能这也是为什么阿里要先从双活再切到多活，历时3年）。比如，业务拆分，依赖拆分，网状改星状，分布式事务，缓存失效等。除了对于编码的要求很高以外，对测试和运维也有非常大的挑战。如此复杂的情况，如何进行自动化覆盖，如何进行演练，如何改造流水线。这种级别的灾备，不是一般公司敢做的，投入产出也不成正比。不过还是可以把这种场景当作我们的“假想敌”，去思考我们自己的业务，未来会怎么发展，需要做到什么级别的灾备。相对而言，饿了么的多活方案可能更适合大多数的企业。
​
本文只是通过画图的方式进行了简单的描述，其实异地多活是需要很多很强大的基础能力的。比如，数据传输，数据校验，数据操作层（简化客户端控制写和同步的过程）等。
​
## [思考](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)
​
文末，留几个问题大家可以思考一下：
​
-   假设你在做饿了么的开发，服务按照异地多活方式部署，sharding key根据省市区进行分片。假设买家在多个城市交汇的地方，比如，十字路口的四个位置分别是4个城市，那么如何处理才能让他拉到比较正常的数据？
-   你们现在的业务模块中，哪些业务是可以做多活的，哪些无法做多活？
-   所有的业务都要做多活吗？还是只需要核心业务做多活？
​
相关实践学习
​
SLB负载均衡实践
​
本场景通过使用阿里云负载均衡 SLB 以及对负载均衡 SLB 后端服务器 ECS 的权重进行修改，快速解决服务器响应速度慢的问题
​
负载均衡入门与产品使用指南
​
负载均衡（Server Load Balancer）是对多台云服务器进行流量分发的负载均衡服务，可以通过流量分发扩展应用系统对外的服务能力，通过消除单点故障提升应用系统的可用性。 本课程主要介绍负载均衡的相关技术以及阿里云负载均衡产品的使用方法。