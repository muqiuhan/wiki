#distributed

20 多年前，Peter Deutsch 和 James Gosling 定义了分布式计算的 8 个谬误。这些是许多开发人员对分布式系统做出的错误假设。从长远来看，这些假设通常被证明是错误的。

![](https://pic3.zhimg.com/v2-fb25b92f31e4317bc84860bdc2145896_b.jpg)

让我们来看看每个谬误，讨论问题和潜在的解决方案。

## 分布式系统的谬误

### 1. 网络可靠

分布式系统本质上是由多个通过网络连接和通信的节点、系统或服务组成。网络中的任何变化或故障都可能中断通信影响系统的功能。

这些故障可能由多种原因引起，比如海底电缆的断裂、交换机故障、断电等。此外，许多用于保障网络可靠性的硬件设备也依赖于某种形式的软件。如果这些软件中存在细微的bug，也可能导致网络问题。这些都说明了一个事实：网络并不可靠。

举个简单的例子，当你在与朋友视频通话时，突然网络中断了，这正是网络不可靠性的表现。可能是路由器出现了故障、网络正在维护，或者其他外部因素导致了中断。

因此，在开发API时，必须考虑网络的不可靠性，并设计容错机制，如重试、幂等操作、自动重新连接等，以确保在网络出现问题时，系统依然能够稳定运行。

![](https://pica.zhimg.com/v2-906f7a2f4974266d75797102d98dbce2_b.jpg)

### 2. 零延迟

在分布式系统中，数据中心或服务器可能分布在全球各地。虽然这种地理上的分布增强了系统的弹性和可靠性，但同时也增加了机器之间通信和数据传输的时间。此外，由于网络本身的不可靠性，数据包可能会出现延迟，从而进一步延长客户端请求完成的时间。延迟为零的概念是不正确的。

当你在中国访问一个位于美国的网站时，数据需要经过多个路由器和服务器传输，这个过程会产生延迟。这就是延迟不是零的表现。

![](https://pic3.zhimg.com/v2-f86374253f639b98bd13dc7ddbba9d24_b.jpg)

  

### 3. 带宽是无限的

![](https://pic4.zhimg.com/v2-4213fda24569aff3df9095720e6c860d_b.jpg)

带宽是指单位时间内可以通过网络传输的数据量。尽管现代大规模应用程序可能让人觉得带宽似乎是无限的，但实际上，当数据需求超过可用带宽时（例如，在线视频流或在线游戏），网络速度可能会下降，出现限速的情况。

此外，当多个服务共享相同的基础设施资源（如消息代理）时，为了防止某个高流量的生产者占用过多资源，影响其他服务的性能，每个生产者的带宽通常会受到限制。

如果你有过晚上刷视频的经历，你会发现看视频偶尔会卡顿，这是因为晚上很多人都在使用网络，带宽被占满了。

这一切都说明**带宽是有限的** 。

### 4. 网络是安全的

在设计接受用户输入的网页表单时，有一个基本原则：永远不要信任用户输入。

同样，关于连接开放Wi-Fi网络的建议是：尽量避免连接开放的Wi-Fi。此外，在设计不同服务之间通过网络进行通信时，必须验证请求的来源。这是因为互联网充满了恶意用户，他们会嗅探网络流量以解码通信，或尝试攻击防火墙以访问私有网络、服务或数据库。

例如你在咖啡店连接公共Wi-Fi，黑客可能会嗅探你的网络流量，获取你的私人信息，这就是网络不安全的例子。

这一切表明网络本质上并不安全。因此您在设计系统时要牢记安全性，您需要在网络，基础架构和应用程序级别进行不同的安全检查。

![](https://picx.zhimg.com/v2-6ac79ddc9ff249cc218c1be6558169f7_b.jpg)

  

### 5. 拓扑结构不变

网络拓扑结构并不是一成不变的。它可能因为意外的故障而改变，比如当你的应用服务器故障需要更换时；也可能是有意改变的，比如增加或删除服务器实例，以应对不同的工作负载。如今，随着云计算和容器技术的发展，这种变化变得更加频繁和明显。

![](https://pic3.zhimg.com/v2-e20cd8840b9ec464a91131e0f2fb4044_b.jpg)

  

因此，在设计系统时，必须考虑到系统的弹性和扩展能力，能够根据工作负载的变化灵活地添加或删除服务器，使系统适应网络环境的变化。

### 6. 只有一名管理员

在小型系统中，可能确实只有一个管理员来负责运维工作。

但在现代计算中，由于云计算工具的普及和软件应用程序的复杂性不断增加，一个人几乎不可能处理从设计到开发再到部署的所有事情。大多数互联网应用程序由多个微服务组成，每个微服务都有不同的团队负责，他们各自管理开发、部署工具和周期。因此，让一个人负责所有事情是不现实的。

例如，在一家大型互联网公司，邮件服务、社交平台、视频服务等各个服务由不同的团队开发和维护，每个团队都有专门的管理人员。

![](https://pic1.zhimg.com/v2-ad3bd27dfa91312c911504b9a1f78ed0_b.jpg)

  

### 7. 传输成本为零

![](https://pic4.zhimg.com/v2-1b48055c0dcb98caa777135ad03511bf_b.jpg)

在分布式系统中，为了实现不同实体之间的通信，数据必须通过网络传输。这就像现实中运输货物一样，通过网络传输数据也需要物理硬件、网络带宽、软件和电力等资源。虽然这些传输成本单次看起来可能很小，但随着时间的推移，但最终它们构成了运营在线大规模应用程序的总体费用的很大一部分。

当你使用云存储服务上传大量数据时，会发现需要支付带宽费用，这就是数据传输成本的体现。

### 8. 网络是同质的

在互联网上运行的不同服务或节点，通常在硬件规格和操作参数方面各不相同。例如，每个连接到互联网的设备都有不同的硬件规格，你的手机和公司的服务器性能和配置完全不同，

如果在设计系统时假设所有设备都具有相同的配置，会导致性能或兼容性问题。例如，如果开发一个应用时假设所有设备都是高性能服务器，那么在手机上运行时，可能会非常缓慢。这一原则同样适用于跨多个地理位置部署的大规模分布式系统，其中的物理机器往往具有不同的配置。

![](https://pic4.zhimg.com/v2-b15322b01a4cb9e31606d7862f3a95ab_b.jpg)

[发布于 2024-08-09 08:13](//zhuanlan.zhihu.com/p/713553493)