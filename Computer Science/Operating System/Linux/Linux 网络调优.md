妈的，卡死了这网。

## 调整网络接口配置

### 调整网络接口的 MTU 值以优化网络性能

MTU是最大传输单元，指的是网络接口一次能传输的最大数据包大小，单位是字节，过大可能导致分片或丢包，过小则会增加协议开销，降低吞吐量。

关于优化网络性能，需要考虑不同场景下的最佳MTU值。比如，以太网默认是1500，但如果是VPN或者隧道，可能需要调整到更小，比如1400，以适应额外的头部开销。如果使用巨型帧（Jumbo Frames），MTU可以设置为9000，但这需要整个网络路径的支持。

|**网络环境**|**推荐 MTU**|**说明**|
|---|---|---|
|标准以太网|1500|默认值，适用于大多数场景|
|PPPoE 宽带（ADSL）|1492|PPPoE 协议占用 8 字节头部|
|VPN/IPsec 隧道|1400-1420|加密头部增加开销（如 OpenVPN 占用 60+ 字节）|
|无线网络（Wi-Fi）|2304|802.11 协议支持，但通常沿用 1500|
|巨型帧（Jumbo Frame）|9000|需交换机、路由器和接收端全部支持|
可以通过 ping 命令测试不分片的最大 MTU：

```shell
# 注：-s 指定数据部分大小，总包大小 = -s + 28（IP头20 + ICMP头8）
ping -M do -s 1472 192.168.1.1
```

查看默认值:

```shell
ip link show 设备 | grep mtu
```

调整方式:

```shell
sudo ifconfig interface mtu 1500
```

## 优化 TCP 堆栈

可以通过 `/proc/sys/net/core/` 下的文件加大 tcp 缓冲区的大小，除此之外，还可以根据自己的网络环境使用不同的拥塞控制算法：

CUBIC是Linux的默认算法，基于丢包反馈调整窗口，适合高带宽延迟积的网络。而BBR则关注带宽和RTT，避免依赖丢包，可能在高丢包环境下表现更好。Vegas是通过测量RTT变化来判断拥塞，可能在低延迟要求的场景有用。Westwood可能针对无线网络优化，因为无线网络容易有随机丢包。

传统的有线网络用CUBIC或Reno可能更合适，而移动网络可能适合Westwood或Vegas。BBR适合需要高吞吐且延迟敏感的环境，比如视频流。另外，像DCTCP适用于数据中心内部，因为处理的是短暂流量和低延迟需求。

简单来说：

| **网络环境**     | **推荐算法**   |
| ------------ | ---------- |
| 传统有线网络（默认）   | CUBIC      |
| 高丢包无线网络      | Westwood+  |
| 数据中心内部       | DCTCP      |
| 高吞吐低延迟（如视频流） | BBR        |
| 实时通信（低延迟敏感）  | Vegas      |
| 兼容性和稳定性优先    | Reno/CUBIC |

详细来说：

1. CUBIC
	- **原理**：基于丢包反馈的算法，通过三次函数调整拥塞窗口（Cubic 函数），逐步探测带宽上限。
	- **适用场景**：高带宽延迟积（BDP）网络（如现代互联网），Linux 默认算法。
	- **优点**：
	    - 在高带宽长距离网络中表现稳定。
	    - 兼容性强，适合混合网络环境。
	- **缺点**：
	    - 依赖丢包作为拥塞信号，可能在高丢包或动态网络中效率下降。
2. Reno
	- **原理**：经典 AIMD（加性增/乘性减）算法，通过慢启动、拥塞避免、快速重传和快速恢复管理窗口。
	- **适用场景**：传统有线网络，低带宽或低延迟环境。
	- **优点**：
	    - 简单可靠，广泛兼容。
	- **缺点**：
	    - 对高带宽延迟积网络效率低。
	    - 无法快速适应突发流量。
3. BBR (Bottleneck Bandwidth and RTT)
	- **原理**：基于带宽和 RTT 测量动态调整窗口，主动探测瓶颈带宽和最小延迟。
	- **适用场景**：高吞吐、低延迟需求（如视频流、CDN），高丢包或波动网络（如卫星链路）。
	- **优点**：
	    - 避免依赖丢包信号，减少排队延迟。
	    - 在高丢包网络中仍能保持高吞吐。
	- **缺点**：
	    - 需要（≥4.9） 以上的内核版本才支持。
	    - 可能与其他算法共存时不公平占用带宽。
4. Vegas
	- **原理**：通过测量 RTT 变化预测拥塞，提前调整窗口以避免丢包。
	- **适用场景**：低延迟敏感场景（如实时通信），低竞争网络。
	- **优点**：
	    - 减少丢包和排队延迟。
	    - 更平滑的吞吐。
	- **缺点**：
	    - 在网络中存在非 Vegas 流时性能下降。
	    - 对 RTT 测量误差敏感。
5. Westwood/Westwood+
	- **原理**：基于带宽估计调整窗口，优化无线网络中的随机丢包问题。
	- **适用场景**：无线网络（Wi-Fi、移动网络），高随机丢包环境。
	- **优点**：
	    - 区分拥塞丢包和无线误码丢包，减少不必要降窗。
	- **缺点**：
	    - 对带宽估计依赖较高，复杂网络下可能不稳定。
6. DCTCP (Data Center TCP)
	- **原理**：利用 ECN（显式拥塞通知）标记，快速响应拥塞，保持低队列深度。
	- **适用场景**：数据中心内部网络（短 RTT、高吞吐、低延迟需求）。
	- **优点**：
	    - 极低延迟和队列积压。
	    - 适合突发流量。
	- **缺点**：
	    - 需要网络设备支持 ECN。
	    - 不适用于广域网。
7. HyStart (Hybrid Slow Start)
	- **原理**：改进的慢启动算法，结合延迟和丢包信号避免过早进入拥塞避免阶段。
	- **适用场景**：高带宽网络中避免激进慢启动导致的丢包。
	- **优点**：
	    - 减少慢启动阶段的过度膨胀。
	- **缺点**：
	    - 通常作为其他算法（如 CUBIC）的补充模块使用。
8. BIC (Binary Increase Congestion Control)
	- **原理**：通过二分搜索快速收敛到公平带宽分配，CUBIC 的前身。
	- **适用场景**：早期高带宽网络。
	- **优点**：
	    - 在高 BDP 网络中比 Reno 更快收敛。
	- **缺点**：
	    - 已被 CUBIC 取代，算法较为陈旧。

**查看可用算法**：
`sysctl net.ipv4.tcp_available_congestion_control`

**查看当前算法**：
`sysctl net.ipv4.tcp_congestion_control`

**切换算法**（如切换到 BBR）：
`sysctl -w net.ipv4.tcp_congestion_control=bbr`

### **TIME_WAIT套接字回收**

- https://developer.aliyun.com/article/1593928