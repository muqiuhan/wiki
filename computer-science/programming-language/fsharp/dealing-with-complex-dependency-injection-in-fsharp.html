<html><head>
		<title>Dealing with complex dependency injection in FSharp</title>
		<base href="../../../">
		<meta id="root-path" root-path="../../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="韩暮秋的个人维基 - Dealing with complex dependency injection in FSharp">
		<meta property="og:title" content="Dealing with complex dependency injection in FSharp">
		<meta property="og:description" content="韩暮秋的个人维基 - Dealing with complex dependency injection in FSharp">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://muqiuhan.github.io/wiki/computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="韩暮秋的个人维基">
		<meta name="author" content="韩暮秋"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="lib/scripts/pixi.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="lib/scripts/minisearch.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.jpg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon show-file-explorer-navigation"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Dealing with complex dependency injection in FSharp"><p dir="auto">Dealing with complex dependency injection in FSharp</p></h1><div><p dir="auto"><a href="?query=tag:fp" class="tag" target="_blank" rel="noopener">#fp</a> <a href="?query=tag:fsharp" class="tag" target="_blank" rel="noopener">#fsharp</a> </p></div><div><p dir="auto">Today, we're going to cover different ways of encapsulating capabilities and supplying them between functions using functional programming techniques which can be realized in F#.</p></div><div><p dir="auto">Managing code dependencies in object oriented languages in 2020 is pretty much one sided problem: dependency injection has won, people use dedicated frameworks to handle that for them, which 99.9% of the time operate using runtime reflection. Of course now you need to learn them as well, potentially misconfigure them and fail at runtime or maybe even discover that not every problem is a stateless web service, but it still better (?) than what we had in the past, and what more can we possibly do anyway?</p></div><div><p dir="auto">On the other side in functional space, there's no one opinionated solution or approach - various things have been proposed, usually depending on features that languages and compiler have to offer. And since pretty much all functional languages offer this thing known as partial application, for many years it was the most common answer for the problem of managing dependencies.</p></div><div><p dir="auto">In short we're talking about dependency injection by function parameter, like:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token comment">// foo requires 2 dependencies to serve the incoming request</span>
<span class="token keyword">let</span> foo bar baz request <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>
<span class="token comment">// we're providing dependencies by partial application</span>
<span class="token keyword">let</span> wired <span class="token operator">=</span> foo dependency1 dependency2
<span class="token comment">// now wired can serve request directly without calling </span>
<span class="token comment">// dependencies every time</span>
<span class="token keyword">let</span> response <span class="token operator">=</span> wired request
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">It's very simple, doesn't require reflection or dedicated library. However there are several pain points coming with this approach - visible especially as our code base grows and become more complex. However latest approaches popularized by libraries like Scala <a data-tooltip-position="top" aria-label="https://zio.dev/?ref=bartoszsypytkowski.com" rel="noopener" class="external-link" href="https://zio.dev/?ref=bartoszsypytkowski.com" target="_blank">ZIO</a> or Haskell's <a data-tooltip-position="top" aria-label="https://youtu.be/idU7GdlfP9Q?t=1394&amp;ref=bartoszsypytkowski.com" rel="noopener" class="external-link" href="https://youtu.be/idU7GdlfP9Q?t=1394&amp;ref=bartoszsypytkowski.com" target="_blank">Polysemy</a> challenge this approach.</p></div><div class="heading-wrapper"><h2 data-heading="Partial application" dir="auto" class="heading" id="Partial_application"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Partial application</h2><div class="heading-children"><div><p dir="auto">There are some design decisions, when partial application doesn't always give a clear answer. Example:</p></div><div><blockquote dir="auto">
<p>Imagine using a set of methods, that are closely related and - in object oriented world - encapsulated within &nbsp;a single object, like database query/execute or different logging methods (debug/info/warning/error).</p>
</blockquote></div><div><p dir="auto">Now, given that our function needs to use potentially more than one of these, how should we pass our arguments?:</p></div><div><ol>
<li data-line="0" dir="auto">Functional purist path - pass every dependency as a separate function parameter: <code>let doSmth logError logInfo = ??</code>. While it allows us to precisely describe what this function uses, it would of course lead to explosion of function parameters. Additionally every time you need new function in your existing code, you need to partially apply it at all call sites.</li>
<li data-line="1" dir="auto">Describe operations using ADT (algebraic data types) and inject a function that will work as an interpreter for them: <code>let doSmth (log: LogEvent -&gt; unit) = ??</code>. While it's easy to mock (you don't need to implement everything, only pattern match on cases that matter for a particular test) and reduces params affinity, it also comes with a lot of indirection, that may lead to harder to grasp, especially during debugging. Sometimes a performance penalty is also to be expected.</li>
<li data-line="2" dir="auto">Fallback to objects/interfaces and pass them as methods: <code>let doSmth (logger: ILogger) = ??</code>. While interfaces may simplify dependency tree, it's not always obvious when to use it. Mocking story is also more painful + interfaces are not inferred by F# compiler.</li>
</ol></div><div><p dir="auto">These are quite common options I've seen in the wild - each having their own advantages and disadvantages. Which one to use? Good question, as in practice with codebases that are old enough, you usually see 2 or even all 3 of them mixed together. This can lead to some confusion and obscurity over time.</p></div><div><p dir="auto">What's worse, none of these cases really solves problem of dependency management - all they do is just try to reduce it to a manageable scope. Eventually you'll end up manually wiring - by partial application - dozens of functions and managing all of the dependencies between them by hand.</p></div><div class="heading-wrapper"><h3 data-heading="Example" dir="auto" class="heading" id="Example"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Example</h3><div class="heading-children"><div><p dir="auto">In order to get better understanding, we'll use a fairly simple example - changing user password:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">let</span> fetchUser <span class="token punctuation">(</span>db<span class="token punctuation">:</span> <span class="token class-name">IDbConnection</span><span class="token punctuation">)</span> userId <span class="token operator">=</span> 
    db<span class="token punctuation">.</span><span class="token function">QueryFirstAsync</span><span class="token punctuation">(</span>Sql<span class="token punctuation">.</span>FetchUser<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">|</span> userId <span class="token operator">=</span> userid<span class="token operator">|</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
<span class="token keyword">let</span> updateUser <span class="token punctuation">(</span>db<span class="token punctuation">:</span> <span class="token class-name">IDbConnection</span><span class="token punctuation">)</span> user <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>Sql<span class="token punctuation">.</span>UpdateUser<span class="token punctuation">,</span> user<span class="token punctuation">)</span>

<span class="token keyword">let</span> changePass <span class="token punctuation">(</span>logger<span class="token punctuation">:</span> <span class="token class-name">ILogger</span><span class="token punctuation">)</span> fetch update <span class="token operator">=</span> <span class="token keyword">fun</span> req <span class="token operator">-&gt;</span> <span class="token computation-expression keyword">task</span> <span class="token punctuation">{</span>
    <span class="token keyword">let!</span> user <span class="token operator">=</span> fetch req<span class="token punctuation">.</span>UserId
    <span class="token keyword">if</span> user<span class="token punctuation">.</span>Hash <span class="token operator">=</span> bcrypt user<span class="token punctuation">.</span>Salt req<span class="token punctuation">.</span>OldPass <span class="token keyword">then</span>
        <span class="token keyword">let</span> salt <span class="token operator">=</span> generateSalt <span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> user' <span class="token operator">=</span> <span class="token punctuation">{</span> user <span class="token keyword">with</span> Salt <span class="token operator">=</span> salt<span class="token punctuation">;</span> Hash <span class="token operator">=</span> bcrypt salt req<span class="token punctuation">.</span>NewPass <span class="token punctuation">}</span>
        <span class="token keyword">do</span><span class="token operator">!</span> update user'
        logger<span class="token punctuation">.</span>LogInformation <span class="token string">"Password change: user %i"</span> user<span class="token punctuation">.</span>Id
        <span class="token keyword">return</span> Ok <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> 
        logger<span class="token punctuation">.</span>LogError <span class="token string">"Password change unauthorized: user %i"</span> user<span class="token punctuation">.</span>Id
        <span class="token keyword">return</span> Error <span class="token string">"Old password is invalid"</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Here we have a fairly short snippet with some dependencies? But how many in practice?:</p></div><div><ul>
<li data-line="0" dir="auto">Number of parameters suggest 3, but depending on our choices it could be 4 (if we decide to pass log error and info separately) or 2 (if we conflate fetch/update into dedicated interface).</li>
<li data-line="1" dir="auto">It's not hard to imagine that in the future our <code>bcrypt</code> hashing function may turn out to be configurable - maybe even per each user. That may need a configurable parameter.</li>
<li data-line="2" dir="auto">Maybe aside of the logger we may be needing a separate telemetry mechanism to count number of incoming request or password validation failures? That means another parameter.</li>
<li data-line="3" dir="auto">Salt generation is pseudo-random process - it we want our function to be deterministic, we should probably parametrize it over explicitly passed <code>Random</code> as well.</li>
</ul></div><div><p dir="auto">As you see, what seemed to be simple task at the beginning can quickly blow up out of proportion. As the number of arguments grows, the more nasty our wiring code eventually becomes. Quite common pattern is to hide all of that nastiness under the carpet a.k.a. <strong>composition root</strong>. However this doesn't have to be the case.</p></div><div><p dir="auto">Below we'll cover another approach for dealing with dependencies - inspired by Scala <a data-tooltip-position="top" aria-label="https://medium.com/@pascal.mengelt/what-are-the-benefits-of-the-zio-modules-with-zlayers-3bf6cc064a9b?ref=bartoszsypytkowski.com" rel="noopener" class="external-link" href="https://medium.com/@pascal.mengelt/what-are-the-benefits-of-the-zio-modules-with-zlayers-3bf6cc064a9b?ref=bartoszsypytkowski.com" target="_blank">ZIO</a> library - using incremental steps, from first principles to monadic bindings.</p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="Managing dependencies beyond partial application" dir="auto" class="heading" id="Managing_dependencies_beyond_partial_application"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Managing dependencies beyond partial application</h2><div class="heading-children"><div><p dir="auto">Let's start from how our code from above will eventually look like at the end of this step:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">let</span> changePass env <span class="token operator">=</span> <span class="token keyword">fun</span> req <span class="token operator">-&gt;</span> <span class="token computation-expression keyword">task</span> <span class="token punctuation">{</span>
    <span class="token keyword">let!</span> user <span class="token operator">=</span> Db<span class="token punctuation">.</span>fetchUser env req<span class="token punctuation">.</span>UserId
    <span class="token keyword">if</span> user<span class="token punctuation">.</span>Hash <span class="token operator">=</span> bcrypt user<span class="token punctuation">.</span>Salt req<span class="token punctuation">.</span>OldPass <span class="token keyword">then</span>
        <span class="token keyword">let</span> salt <span class="token operator">=</span> Random<span class="token punctuation">.</span>bytes env <span class="token number">32</span>
        <span class="token keyword">do</span><span class="token operator">!</span> Db<span class="token punctuation">.</span>updateUser <span class="token computation-expression keyword">env</span> <span class="token punctuation">{</span> user <span class="token keyword">with</span> Salt <span class="token operator">=</span> salt<span class="token punctuation">;</span> Hash <span class="token operator">=</span> bcrypt salt req<span class="token punctuation">.</span>NewPass <span class="token punctuation">}</span>
        Log<span class="token punctuation">.</span>info env <span class="token string">"Changed password for user %i"</span> user<span class="token punctuation">.</span>Id
        <span class="token keyword">return</span> Ok <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> 
        Log<span class="token punctuation">.</span>error env <span class="token string">"Password change unauthorized: user %i"</span> user<span class="token punctuation">.</span>Id
        <span class="token keyword">return</span> Error <span class="token string">"Old password is invalid"</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">As you may notice, all of our partially applied parameters disappeared, replaced by some single cryptic <code>env</code> parameter. We'll get there soon. We also packed similar capabilities into corresponding modules (<code>Db</code>/<code>Log</code>/<code>Random</code>). Lets start from defining them:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Interface</span><span class="token punctuation">&gt;]</span></span>
<span class="token keyword">type</span> <span class="token class-name">ILogger</span> <span class="token operator">=</span>
    <span class="token keyword">abstract</span> Debug<span class="token punctuation">:</span> <span class="token class-name">string <span class="token operator">-&gt;</span> unit</span>
    <span class="token keyword">abstract</span> Error<span class="token punctuation">:</span> <span class="token class-name">string <span class="token operator">-&gt;</span> unit</span> 

<span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Interface</span><span class="token punctuation">&gt;]</span></span> <span class="token keyword">type</span> <span class="token class-name">ILog</span> <span class="token operator">=</span> <span class="token keyword">abstract</span> Logger<span class="token punctuation">:</span> <span class="token class-name">ILogger</span>

<span class="token keyword">module</span> Log <span class="token operator">=</span>
    <span class="token keyword">let</span> debug <span class="token punctuation">(</span>env<span class="token punctuation">:</span> #ILog<span class="token punctuation">)</span> fmt <span class="token operator">=</span> Printf<span class="token punctuation">.</span>kprintf env<span class="token punctuation">.</span>Logger<span class="token punctuation">.</span>Debug fmt
    <span class="token keyword">let</span> error <span class="token punctuation">(</span>env<span class="token punctuation">:</span> #ILog<span class="token punctuation">)</span> fmt <span class="token operator">=</span> Printf<span class="token punctuation">.</span>kprintf env<span class="token punctuation">.</span>Logger<span class="token punctuation">.</span>Error fmt
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Now we can say something more about <code>env</code>. The secret is in <code>#ILog</code> signature, which means that our environment can be any generic type implementing <code>ILog</code> interface. As soon you'll see, this approach is highly composable, but before that we'll need another module:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Interface</span><span class="token punctuation">&gt;]</span></span>
<span class="token keyword">type</span> <span class="token class-name">IDatabase</span> <span class="token operator">=</span>
    <span class="token keyword">abstract</span> Query<span class="token punctuation">:</span> <span class="token class-name">string</span> <span class="token operator">*</span> 'i <span class="token operator">-&gt;</span> Task<span class="token operator">&lt;</span>'o<span class="token operator">&gt;</span>
    <span class="token keyword">abstract</span> Execute<span class="token punctuation">:</span> <span class="token class-name">string</span> <span class="token operator">*</span> 'i <span class="token operator">-&gt;</span> Task
	
<span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Interface</span><span class="token punctuation">&gt;]</span></span> <span class="token keyword">type</span> <span class="token class-name">IDb</span> <span class="token operator">=</span> <span class="token keyword">abstract</span> Database<span class="token punctuation">:</span> <span class="token class-name">IDatabase</span>

<span class="token keyword">module</span> Db <span class="token operator">=</span> 
    <span class="token keyword">let</span> fetchUser <span class="token punctuation">(</span>env<span class="token punctuation">:</span> #IDb<span class="token punctuation">)</span> userId <span class="token operator">=</span> 
        env<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>Sql<span class="token punctuation">.</span>FetchUser<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">|</span> userId <span class="token operator">=</span> userId <span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> updateUser <span class="token punctuation">(</span>env<span class="token punctuation">:</span> #IDb<span class="token punctuation">)</span> user <span class="token operator">=</span> env<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>Sql<span class="token punctuation">.</span>UpdateUser<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Now what will happen if we use functions from both <code>Log</code> and <code>Db</code> modules? As it turns out, F# compiler can properly infer generic constraints over these interfaces. The result <code>env</code> type constraint is inferred to be an union - just like set union, which also means that it handles duplicates for us - of all constraints of other functions using <code>env</code> in its scope:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">let</span> foo env <span class="token operator">=</span> <span class="token comment">// env :&gt; IDb and env :&gt; ILog</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> Db<span class="token punctuation">.</span>fetchUser env <span class="token number">123</span>	<span class="token comment">// env :&gt; IDb</span>
    Log<span class="token punctuation">.</span>debug env <span class="token string">"User: %A"</span> user	<span class="token comment">// env :&gt; ILog</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Now why did we use two separate interfaces (<code>ILog</code>/<code>ILogger</code>) instead of making environment implement <code>ILogger</code> directly? This is more practical approach that will let us isolate capabilities of particular modules rather than putting them flat into our environment. Example:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">module</span> Log <span class="token operator">=</span>
    <span class="token keyword">let</span> live <span class="token punctuation">:</span> <span class="token class-name">ILogger</span> <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token comment">// create logger interface</span>

<span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Struct</span><span class="token punctuation">&gt;]</span></span>
<span class="token keyword">type</span> <span class="token class-name">AppEnv</span> <span class="token operator">=</span> 
    <span class="token keyword">interface</span> <span class="token class-name">ILog</span> <span class="token keyword">with</span> <span class="token keyword">member</span> _<span class="token punctuation">.</span>Logger <span class="token operator">=</span> Log<span class="token punctuation">.</span>live
    <span class="token keyword">interface</span> <span class="token class-name">IDb</span> <span class="token keyword">with</span> <span class="token keyword">member</span> _<span class="token punctuation">.</span>Database <span class="token operator">=</span> Db<span class="token punctuation">.</span>live connectionString
	
foo <span class="token punctuation">(</span><span class="token function">AppEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">We cannot eagerly provide a specific implementation of <code>ILog</code>/<code>IDb</code>, because they're yet to be defined as part of by our environment type (which may need to implement many interfaces). To maintain module encapsulation <code>Log</code> module shouldn't be aware of existence or implementation of <code>IDb</code> interface and vice versa for <code>Db</code> module. What we can do however is to provide <code>live</code> implementation of <code>ILogger</code>, which encapsulates capabilities required by the <code>Log</code> module. This way we don't need to know details of <code>ILogger</code> when defining our environment type.</p></div><div><p dir="auto">Strong sides of this approach?:</p></div><div><ul>
<li data-line="0" dir="auto">We only need to provide a single environment object instead of (potentially) unbounded list of parameters. Since it's always one, it's easier to generalize and compose other functions over it.</li>
<li data-line="1" dir="auto">Unlike in reflection-based dependency injection frameworks - everything is still safe and checked by the compiler. If our environment type will not implement an interface required somewhere in the call chain, our code will simply not compile.</li>
<li data-line="2" dir="auto">It's still fairly easy to unit test - each function defines only the generic type constraints that it uses in its own call tree, NOT all of the constraints required by the application.</li>
<li data-line="3" dir="auto">New dependencies are added implicitly - if your code uses module that requires additional capability, it will be automatically inferred by the compiler and bubble up to our environment type definition. No need to add new function parameters or to pass new argument. Also - unlike the object oriented IoC containers - there's no need to add new dependency as a field or constructor argument.</li>
<li data-line="4" dir="auto">It gives some opinionated approach on what should be a dependency - less thinking of <em>"should that be a function or interface?"</em> or <em>"if these two functions correspond to the same capability, should they be passed separately?"</em>, which arguably may be a good thing.</li>
<li data-line="5" dir="auto">It doesn't impose specific restrictions on libraries and frameworks.</li>
</ul></div><div><p dir="auto">Now we could as well stop here - IMHO this approach is already good and useful for most cases. We can also try to push it further. As you've seen, our code now requires quite a lot of <code>env</code> passing around. Could we do something about this? It turns out that yes, we could.</p></div></div></div><div class="heading-wrapper"><h2 data-heading="Reader monad" dir="auto" class="heading" id="Reader_monad"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Reader monad</h2><div class="heading-children"><div><p dir="auto">Before we continue: <strong>what we're going to cover now is less useful in terms of current state of F# ecosystem for the reasons I'll mention later</strong>.</p></div><div><p dir="auto">The pattern we'll use here is known as a <strong><a data-tooltip-position="top" aria-label="https://fsharpforfunandprofit.com/posts/elevated-world-6/?ref=bartoszsypytkowski.com" rel="noopener" class="external-link" href="https://fsharpforfunandprofit.com/posts/elevated-world-6/?ref=bartoszsypytkowski.com" target="_blank">Reader Monad</a></strong>. While it's useful in certain situations, it's not widely used - IMO it's fault lies in the name itself, which somehow managed to sound both borderline meaningless and scary in ears of many developers.</p></div><div><p dir="auto">The rest of this blog post will be introduction to this style in F#, however focused solely around problem of dependency management - we'll ignore other aspects of monads.</p></div><div><p dir="auto">We'll going to reuse our environment type from above, but now encode it directly into another type we'll call <code>Effect</code>. Since I've mentioned that our pattern has M-word in it, you can safely assume that our handler's logic will be defined as a lazy sequence of steps to be executed (sounds almost like async/await). In F# we'll sugar them by using custom computation expression (I'm going to call it <code>effect { ... }</code>) returning our effect type, which we'll define as:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Struct</span><span class="token punctuation">&gt;]</span></span> <span class="token keyword">type</span> <span class="token class-name">Effect</span><span class="token operator">&lt;</span>'env<span class="token punctuation">,</span> 'out<span class="token operator">&gt;</span> <span class="token operator">=</span> Effect <span class="token keyword">of</span> <span class="token punctuation">(</span>'env <span class="token operator">-&gt;</span> 'out<span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Where:</p></div><div><ul>
<li data-line="0" dir="auto"><code>env</code> is our environment type we already talked about above.</li>
<li data-line="1" dir="auto"><code>out</code> defines a returned value type of our effect.</li>
</ul></div><div><p dir="auto">Eventually, with this type in hand our simple request handler will be looking like that:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">let</span> changePass req <span class="token operator">=</span> <span class="token computation-expression keyword">effect</span> <span class="token punctuation">{</span>
    <span class="token keyword">let!</span> user <span class="token operator">=</span> Db<span class="token punctuation">.</span>fetchUser req<span class="token punctuation">.</span>UserId
    <span class="token keyword">if</span> user<span class="token punctuation">.</span>Hash <span class="token operator">=</span> bcrypt user<span class="token punctuation">.</span>Salt req<span class="token punctuation">.</span>OldPass <span class="token keyword">then</span>
        <span class="token keyword">let!</span> salt <span class="token operator">=</span> Random<span class="token punctuation">.</span>bytes <span class="token number">32</span>
        <span class="token keyword">do</span><span class="token operator">!</span> Db<span class="token punctuation">.</span><span class="token computation-expression keyword">updateUser</span> <span class="token punctuation">{</span> user <span class="token keyword">with</span> Salt <span class="token operator">=</span> salt<span class="token punctuation">;</span> Hash <span class="token operator">=</span> bcrypt salt req<span class="token punctuation">.</span>NewPass <span class="token punctuation">}</span>
        <span class="token keyword">do</span><span class="token operator">!</span> Log<span class="token punctuation">.</span>info <span class="token string">"Changed password for user %i"</span> user<span class="token punctuation">.</span>Id
        <span class="token keyword">return</span> Ok <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> 
        <span class="token keyword">do</span><span class="token operator">!</span> Log<span class="token punctuation">.</span>error <span class="token string">"Password change unauthorized: user %i"</span> user<span class="token punctuation">.</span>Id
        <span class="token keyword">return</span> Error <span class="token string">"Old password is invalid"</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">As you see, there's no more <code>env</code> parameter being passed around. It's now an implicit part of our effect expression. However at the moment we didn't provide enough infrastructure in our code to make that thing work. What we're going to need is a set of operators, we can use to make our computation expression happen.</p></div><div><p dir="auto">First we're going to need some <code>Effect&lt;'env,'out&gt;</code> constructors:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">module</span> Effect <span class="token operator">=</span>
    <span class="token doc-comment comment">/// Create value with no dependency requirements.</span>
    <span class="token keyword">let</span> <span class="token keyword">inline</span> value <span class="token punctuation">(</span>x<span class="token punctuation">:</span> 'out<span class="token punctuation">)</span><span class="token punctuation">:</span> Effect<span class="token operator">&lt;</span>'env<span class="token punctuation">,</span>'out<span class="token operator">&gt;</span> <span class="token operator">=</span> Effect <span class="token punctuation">(</span><span class="token keyword">fun</span> _ <span class="token operator">-&gt;</span> x<span class="token punctuation">)</span>
    <span class="token doc-comment comment">/// Create value which uses depenendency.</span>
    <span class="token keyword">let</span> <span class="token keyword">inline</span> apply <span class="token punctuation">(</span>fn<span class="token punctuation">:</span> 'env <span class="token operator">-&gt;</span> 'out<span class="token punctuation">)</span><span class="token punctuation">:</span> Effect<span class="token operator">&lt;</span>'env<span class="token punctuation">,</span>'out<span class="token operator">&gt;</span> <span class="token operator">=</span> Effect fn
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">We also need some way to run our effect to be able to make it... well effectful:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">module</span> Effect <span class="token operator">=</span>

	<span class="token comment">(* ...other functions... *)</span>
	
    <span class="token keyword">let</span> run <span class="token punctuation">(</span>env<span class="token punctuation">:</span> 'env<span class="token punctuation">)</span> <span class="token punctuation">(</span>Effect fn<span class="token punctuation">)</span><span class="token punctuation">:</span> 'out <span class="token operator">=</span> fn env
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">And since we already mentioned <code>Effect</code> is monad, we also gonna need a <code>bind</code> function as well if we want to compose our effects together:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">module</span> Effect <span class="token operator">=</span>

	<span class="token comment">(* ...other functions... *)</span>
	
    <span class="token keyword">let</span> <span class="token keyword">inline</span> bind <span class="token punctuation">(</span>fn<span class="token punctuation">:</span> 'a <span class="token operator">-&gt;</span> Effect<span class="token operator">&lt;</span>'env<span class="token punctuation">,</span>'b<span class="token operator">&gt;</span><span class="token punctuation">)</span> effect <span class="token operator">=</span>
        Effect <span class="token punctuation">(</span><span class="token keyword">fun</span> env <span class="token operator">-&gt;</span>
            <span class="token keyword">let</span> x <span class="token operator">=</span> run env effect <span class="token comment">// compute result of the first effect</span>
            run env <span class="token punctuation">(</span>fn x<span class="token punctuation">)</span> <span class="token comment">// run second effect, based on result of first one</span>
        <span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">This is pretty much it. We're just going to add compose all of these into builder type to make it usable as F# computation expression:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token annotation"><span class="token punctuation">[&lt;</span><span class="token class-name">Struct</span><span class="token punctuation">&gt;]</span></span>
<span class="token keyword">type</span> <span class="token class-name">EffectBuilder</span> <span class="token operator">=</span>
    <span class="token keyword">member</span> <span class="token keyword">inline</span> __<span class="token punctuation">.</span>Return value <span class="token operator">=</span> Effect<span class="token punctuation">.</span>value value
    <span class="token keyword">member</span> <span class="token keyword">inline</span> __<span class="token punctuation">.</span>Zero <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> Effect<span class="token punctuation">.</span>value <span class="token punctuation">(</span>Unchecked<span class="token punctuation">.</span>defaultof<span class="token operator">&lt;</span>_<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token keyword">member</span> <span class="token keyword">inline</span> __<span class="token punctuation">.</span>ReturnFrom <span class="token punctuation">(</span>effect<span class="token punctuation">:</span> <span class="token class-name">Effect</span><span class="token operator">&lt;</span>'env<span class="token punctuation">,</span> 'out<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=</span> effect
    <span class="token keyword">member</span> <span class="token keyword">inline</span> __<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>effect<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token operator">=</span> Effect<span class="token punctuation">.</span>bind fn effect
    
<span class="token keyword">let</span> effect <span class="token operator">=</span> <span class="token function">EffectBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Of course this, we still need to adapt the modules we prepared earlier to now operate on effects rater than plain functions. We can make this easier by using our <code>Effect.apply</code> function, like:</p></div><div><pre class="language-fsharp" tabindex="0"><code class="language-fsharp is-loaded"><span class="token keyword">module</span> Log <span class="token operator">=</span>    
    <span class="token keyword">let</span> debug fmt <span class="token operator">=</span>
        <span class="token keyword">let</span> ap s <span class="token operator">=</span> Effect<span class="token punctuation">.</span>apply <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> #ILog<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x<span class="token punctuation">.</span>Logger<span class="token punctuation">.</span>Debug s<span class="token punctuation">)</span>
        Printf<span class="token punctuation">.</span>kprintf ap fmt
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">So - as you may have noticed in final form of our effect-based <code>changePass</code> function - in result we almost fully erased all of the dependency-wiring code from our example. There are several downsides of this approach:</p></div><div><ul>
<li data-line="0" dir="auto">We do a lot of more bindings (see <code>let!</code>/<code>do!</code> expressions), which means more lambda closures, indirection (wait to see call stacks) and more allocations.</li>
<li data-line="1" dir="auto">Altogether we also erased <code>task { ... }</code> computation expression and with it an out-of-the-box ability to write asynchronous code. This is one of the downsides of using monads - cross-type composition is painful.</li>
</ul></div><div><p dir="auto">Of course we could enrich our <code>Effect</code> type to be able to bind it with <code>Task</code>/<code>Async</code>. That however means, that our pattern grows in complexity and becomes more of a framework rather than something to be easily applied into existing code. Is that bad? Not necessarily, but for sure comes with a bigger commitment, as now you're not only writing business logic but eventually maintain new effect library. Maybe in future this concept will grow into its own space in favor of the F# ecosystem.</p></div></div></div><div class="heading-wrapper"><h2 data-heading="Summary" dir="auto" class="heading" id="Summary"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Summary</h2><div class="heading-children"><div><p dir="auto">We came from partial application as tool for dependency injection, over more structured approach promoting single environment type with help of powerful F# type inference, up to encapsulating it into a Reader Monad. That's a long way. I hope you'll give it a try and it will help you determine the approach that works for you.</p></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html#Dealing with complex dependency injection in FSharp"><div class="tree-item-contents heading-link" heading-name="Dealing with complex dependency injection in FSharp"><span class="tree-item-title">Dealing with complex dependency injection in FSharp</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html#Partial_application"><div class="tree-item-contents heading-link" heading-name="Partial application"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Partial application</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html#Example"><div class="tree-item-contents heading-link" heading-name="Example"><span class="tree-item-title">Example</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html#Managing_dependencies_beyond_partial_application"><div class="tree-item-contents heading-link" heading-name="Managing dependencies beyond partial application"><span class="tree-item-title">Managing dependencies beyond partial application</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html#Reader_monad"><div class="tree-item-contents heading-link" heading-name="Reader monad"><span class="tree-item-title">Reader monad</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/dealing-with-complex-dependency-injection-in-fsharp.html#Summary"><div class="tree-item-contents heading-link" heading-name="Summary"><span class="tree-item-title">Summary</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>