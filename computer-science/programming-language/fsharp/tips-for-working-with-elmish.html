<html><head>
		<title>Tips for working with Elmish</title>
		<base href="../../../">
		<meta id="root-path" root-path="../../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="韩暮秋的个人维基 - Tips for working with Elmish">
		<meta property="og:title" content="Tips for working with Elmish">
		<meta property="og:description" content="韩暮秋的个人维基 - Tips for working with Elmish">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://muqiuhan.github.io/wiki/computer-science/programming-language/fsharp/tips-for-working-with-elmish.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="韩暮秋的个人维基">
		<meta name="author" content="韩暮秋"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="lib/scripts/pixi.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="lib/scripts/minisearch.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.jpg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon show-file-explorer-navigation"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Tips for working with Elmish"><p dir="auto">Tips for working with Elmish</p></h1><div><p dir="auto"><a href="?query=tag:fsharp" class="tag" target="_blank" rel="noopener">#fsharp</a> <a href="?query=tag:fp" class="tag" target="_blank" rel="noopener">#fp</a></p></div><div><p dir="auto"><em>his article is intended for people who are already familiar with the MVU architecture. You can learn more about it on the</em> <a data-tooltip-position="top" aria-label="https://elmish.github.io/elmish/" rel="noopener" class="external-link" href="https://elmish.github.io/elmish/" target="_blank"><em>Elmish website</em></a><em>.</em><br>
本文面向已经熟悉 MVU 架构的人员。您可以在 Elmish 网站上了解更多相关信息。</p></div><div><p dir="auto">I am one of the maintainer of Elmish and I created several <a data-tooltip-position="top" aria-label="http://fable.io" rel="noopener" class="external-link" href="http://fable.io" target="_blank">Fable</a> / Elmish libraries and applications. When doing so, I needed to understand Elmish deeply and I want to take the opportunity of <a data-tooltip-position="top" aria-label="https://sergeytihon.com/2018/10/22/f-advent-calendar-in-english-2018/" rel="noopener" class="external-link" href="https://sergeytihon.com/2018/10/22/f-advent-calendar-in-english-2018/" target="_blank"><em>F# Advent Calendar</em></a> to share with you my tips and knowledge.<br>
我是 Elmish 的维护者之一，我创建了几个 Fable / Elmish 库和应用程序。这样做时，我需要深入了解 Elmish，我想利用 F# Advent Calendar 的机会与大家分享我的技巧和知识。</p></div><div><p dir="auto">I will be covering a lot in this article, so grab yourself a cup of tea 🍵, take a deep breath 💨 and let’s get started 🏁.<br>
我将在这篇文章中介绍很多内容，所以给自己喝杯茶🍵，深呼吸💨，让我们开始吧🏁。</p></div><div class="heading-wrapper"><h1 data-heading="Commands&nbsp;命令" dir="auto" class="heading" id="Commands&nbsp;命令">Commands&nbsp;命令</h1><div class="heading-children"><div><p dir="auto">A command is a container for a function that Elmish executes immediately but, may schedule dispatch of message at any time.<br>
命令是 Elmish 立即执行的函数的容器，但可以随时安排消息的发送。</p></div><div><p dir="auto">For example:&nbsp;例如：</p></div><div><ul>
<li data-line="0" dir="auto">Issue immediately a new Message<br>
立即发出新消息</li>
<li data-line="2" dir="auto">Make an HTTP call and then return the result in your application via a Message<br>
进行 HTTP 调用，然后通过消息将结果返回到您的应用程序中</li>
<li data-line="4" dir="auto">Save data in your storage<br>
将数据保存在您的存储中</li>
</ul></div><div class="heading-wrapper"><h2 data-heading="Basic usage&nbsp;基本用法" dir="auto" class="heading" id="Basic_usage&nbsp;基本用法"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Basic usage&nbsp;基本用法</h2><div class="heading-children"><div><p dir="auto">In this section, I will cover all the default functions offered by Elmish and show an example of it.<br>
在本节中，我将介绍 Elmish 提供的所有默认函数并展示它的示例。</p></div><div><p dir="auto">Use <code>Cmd.none</code> to schedule no Commands.<br>
使用 <code>Cmd.none</code> 不安排任何命令。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Tick : int }
    
type Msg =
    | Tick
    
let private update msg model =
    match msg with
    | Tick -&gt;
        { model with Tick = model.Tick + 1 }, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use <code>Cmd.ofMsg</code> to schedules another message directly, it can be seen as a way to chain messages.<br>
使用 <code>Cmd.ofMsg</code> 直接调度另一条消息，可以看作是一种链接消息的方式。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Value : string }

type Msg =
    | ChangeValue of string
    | ValidateData
    
let private update msg model =
    match msg with
    | ChangeValue newValue -&gt;
        { model with Value = newValue }, Cmd.ofMsg ValidateData
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use<code>Cmd.ofAsync</code> to evaluate an <code>async</code> block and map the result into success or error (of exception).<br>
使用 <code>Cmd.ofAsync</code> 评估 <code>async</code> 块并将结果映射为成功或错误（异常）。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { InputValue : string
      UpperValue : string }
      
type Msg =
    | ToUpper of string
    | OnUpperResult of string
    | OnUpperError of exn

let private update (msg : Msg) (model : Model) =
    match msg with
    | ToUpper txt -&gt;
        let asyncUpper (txt : string) =
            async {
                do! Async.Sleep 1000

                return txt.ToUpper()
            }

        model, Cmd.ofAsync asyncUpper txt OnUpperResult OnUpperError

    | OnUpperResult result -&gt;
        { model with UpperValue = result }, Cmd.none

    | OnUpperError error -&gt;
        Browser.console.error error
        model, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use <code>Cmd.ofFunc</code> to evaluate a simple function and map the result into success or error (of exception).<br>
使用 <code>Cmd.ofFunc</code> 评估一个简单的函数并将结果映射为成功或错误（异常）。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { CurrentRoute : Route
      Value : string
      Tick : int
      UpperValue : string }

type Msg =
    | Save of string
    | OnSaveSuccess of bool
    | OnSaveError of exn
    
let private update (msg : Msg) (model : Model) =
    match msg with
    | Save txt -&gt;
        let save (txt : string) =         
            // If there is an error, an exception will be thrown and captured by Cmd.ofFunc
            Browser.localStorage.setItem("my-app.input", txt)
            true

        model, Cmd.ofFunc save txt OnSaveSuccess OnSaveError

    | OnSaveSuccess result -&gt;
        // Here we can notify the user that the save succeeded
        model, Cmd.none

    | OnSaveError error -&gt;
        // Here we can notifu the user that the save failed
        Browser.console.error error
        model, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use<code>Cmd.performFunc</code> to evaluate a simple function and map the success to a message discarding any possible error.<br>
使用 <code>Cmd.performFunc</code> 评估一个简单的函数，并将成功映射到一条消息，丢弃任何可能的错误。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { IsLoading : bool
      Value : string }

type Msg =
    | Load
    | OnLoadSuccess of bool
    
let private update (msg : Msg) (model : Model) =
    match msg with
    | Load -&gt;
        // This function can never fail so we can use Cmd.performFunc
        let load () =
            let storedValue : string = Browser.localStorage.getItem("my-app.input") :?&gt; string
            if isNull storedValue then
                ""
            else
                storedValue

        { model with IsLoading = true }, Cmd.performFunc load () OnLoadSuccess

    | OnLoadSuccess value -&gt;
        { model with IsLoading = false
                     Value = value }, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use<code>Cmd.attemptFunc</code> to evaluate a simple function and map the error (in case of exception)<br>
使用 <code>Cmd.attemptFunc</code> 计算一个简单的函数并映射错误（如果出现异常）</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Value : string }

type Msg =
    | ChangeValue of string
    | OnLogError of exn
    
let private update (msg : Msg) (model : Model) =
    match msg with
    | ChangeValue newValue -&gt;
        let log (msg : string) =
            // Send a msg to your logger
            // If there is an error it will throw
            Log.send msg

        let msg = sprintf "Value changed from %s to %s" model.Value newValue        

        { model with Value = newValue }, Cmd.attemptFunc log msg OnLogError

    | OnLogError value -&gt;
        // There was an error during logging, should we do something ?
        model, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use <code>Cmd.ofPromise</code> to call <code>promise</code> block and map the results.<br>
使用 <code>Cmd.ofPromise</code> 调用 <code>promise</code> 块并映射结果。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Value : int }

type Msg =
    | Submit
    | OnPromiseSuccess of int
    | OnPromiseError of exn
    
let private update (msg : Msg) (model : Model) =
    match msg with
    | Submit -&gt;
        let myPromise () =
            promise {
                do! Promise.sleep 1000
                return 10
            }

        model, Cmd.ofPromise myPromise () OnPromiseSuccess OnPromiseError

    | OnPromiseSuccess value -&gt;
        { model with Value = value }, Cmd.none

    | OnPromiseError error -&gt;
        Browser.console.error error
        model, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use <code>Cmd.ofSub</code> to call the subscriber. This is useful when you are dealing with an API which use callbacks or to listen to an event.<br>
使用 <code>Cmd.ofSub</code> 呼叫订阅者。当您处理使用回调或侦听事件的 API 时，这非常有用。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Position : Browser.Position option
      ErrorMessage : string }

type Msg =
    | GetPosition
    | GetPositionSuccess of Browser.Position
    | GetPositionError of Browser.PositionError

module Sub =
    // Subscriber used to reach gealocation API
    let getPosition onSuccess onError dispatch =
        Browser.navigator.geolocation.getCurrentPosition(
          onSuccess &gt;&gt; dispatch,
          onError &gt;&gt; dispatch
        )

let update (msg:Msg) (model:Model) =
    match msg with
    | GetPosition -&gt;
        model, Cmd.ofSub (Sub.getPosition GetPositionSuccess GetPositionError)
    
    | GetPositionSuccess posision -&gt;
        { model with Position = Some position
                     ErrorMessage = "" }, Cmd.none
    
    | GetPositionError error -&gt;
        { model with Position = None
                     ErrorMessage = error.message }, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Use <code>Cmd.batch</code> to aggregate multiple commands. You can aggregate any of the previous commands together.<br>
使用 <code>Cmd.batch</code> 聚合多个命令。您可以将前面的任何命令聚合在一起。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Data1 : int
      Data2 : int }

type Msg =
    | FetchDatas
    | OnFetchData1 of int
    | OnFetchData2 of int
    | OnPromiseError of exn
    | OnLogError of exn
    
let private update (msg : Msg) (model : Model) =
    match msg with
    | FetchDatas -&gt;
        model, Cmd.batch [ Cmd.ofPromise fetchData1 () OnFetchData1 OnPromiseError 
                           Cmd.ofPromise fetchData2 () OnFetchData2 OnPromiseError 
                           Cmd.performFunc log "FetchDatas message has been treated" OnLogError ]

    | OnFetchData1 data1 -&gt;
        { model with Data1 = data1 }, Cmd.performFunc log "FetchData1 data has been received" OnLogError

    | OnFetchData2 data2 -&gt;
        { model with Data2 = data2 }, Cmd.performFunc log "FetchData2 data has been received" OnLogError

    | OnPromiseError error -&gt;
        Browser.console.error("An error occured when fetching data", error)
        model, Cmd.none

    | OnLogError error -&gt;
        Browser.console.error("An error occured when logging", error)
        model, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">The functions provided out of the box by Elmish are enough to cover most of the needs of your application. However, when working on a library or with a specific API you could want to create your own commands. We will take a look at it later.<br>
Elmish 提供的开箱即用的功能足以满足您应用程序的大部分需求。但是，当使用库或特定 API 时，您可能想要创建自己的命令。我们稍后会看一下。</p></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="Modelize your Model according to your needs" dir="auto" class="heading" id="Modelize_your_Model_according_to_your_needs">Modelize your Model according to your needs</h1><div class="heading-children"><div><p dir="auto">根据您的需求对模型进行建模</p></div><div><p dir="auto">When working with a Single Page Application, you will have to deal with navigation and need to reflect it in your models.<br>
使用单页应用程序时，您将必须处理导航并需要将其反映在模型中。</p></div><div><p dir="auto">In general, when I am working with at a page level, I use Discrimination Union so I can store only the active page state.<br>
一般来说，当我在页面级别工作时，我使用歧视联盟，这样我就可以只存储活动页面状态。<br>
For example, if in your application you have a <strong>login</strong> page <strong>you can’t store</strong> your <strong>authenticated</strong> page state in your application because you can’t fetch the resource to display it.<br>
例如，如果您的应用程序中有一个登录页面，您无法在应用程序中存储经过身份验证的页面状态，因为您无法获取资源来显示它。</p></div><div><p dir="auto">In general my main <code>Model</code> looks like this:<br>
一般来说，我的主要 <code>Model</code> 看起来像这样：</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">
[&lt;RequireQualifiedAccess&gt;]
type AuthPage =
    // Section for the website related to Messages management
    // For example
    // - Display the list of Messages
    // - Create a message
    | Messages of Messages.Model
    // Administration section of the website
    | Administration of Administration.Model

[&lt;RequireQualifiedAccess&gt;]
type Page =
    // The application is loading, display a loader
    | Loading
    // Login page
    | Login of Login.Model
    // From here, the user need to be authenticated
    | AuthPage of AuthPage
    // Global error page like:
    // - Generic error
    // - You need to be connected
    | Errored of Errored.Reason
    // A page that can be accessed when the user is not logged in
    // For example, to reset it's password from an URL
    | ResetAccount of ResetAccount.Model

type Model =
    { // Store the user session information
      // If Some xxx, then the user is signed-in
      // If None, the user isn't connected
      Session : User option
      // Store the active page state
      ActivePage : Page
      // Store the current route information, this is useful if your
      // route have parameters than you need to pass to child later
      CurrentRoute : Router.Route option }```

Using DUs to represent your pages state helps you isolate your logics. For me, the biggest benefit compared to storing all page states in a big record, is that you are not caching your page when navigating.  
使用 DU 表示页面状态可以帮助您隔离逻辑。对我来说，与将所有页面状态存储在大记录中相比，最大的好处是您在导航时不会缓存页面。

Of course sometimes your application needs to maintain state between navigation. For example, if you have a form in several steps you could modelize it like this:  
当然，有时您的应用程序需要在导航之间维护状态。例如，如果您有一个分几个步骤的表单，您可以像这样对其进行建模：
```F#
type Rank =
    | One
    | Two

type Step1 =
    { Login : string
      Password : string }

type Step2 =
    { Age : int 
      Surname : string 
      Firstname : string }

type Model =
    { CurrentRank : Rank
      Step1 : Step1
      Step2 : Step2 }

let private view (model : Model) (dispatch : Msg -&gt; unit) =
    match model.CurrentRank with
    | Rank.One -&gt; // render step n°1 form
    | Rank.Two -&gt; // render step n°2 form
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h1 data-heading="Everything is a function&nbsp;一切都是函数" dir="auto" class="heading" id="Everything_is_a_function&nbsp;一切都是函数">Everything is a function&nbsp;一切都是函数</h1><div class="heading-children"><div><p dir="auto">One thing we tend to forget when working with Elmish is that <strong>everything is a function</strong>. The main reason for this forgetfulness is that most of the examples only show you this code:<br>
使用 Elmish 时我们容易忘记的一件事是一切都是函数。造成这种遗忘的主要原因是大多数示例仅向您展示以下代码：</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type Model =
    { Value : int }

type Msg =
    | SomeAction

let init =
    { Value = 0 }, Cmd.none

let update (msg : Msg) (model : Model) : Model * Cmd&lt;Msg&gt; =
    match msg with
    | SomeAction -&gt;
        model, Cmd.none

let view (model : Model) (dispatch : Msg -&gt; unit) : React.ReactElement =
    div [ ]
        [ str "This is my view" ]
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">So in our mind <code>update</code> <strong>takes two arguments</strong> when in fact we should think <code>update</code> <strong>takes at least two arguments</strong>. The same applies to <code>view</code> and <code>init</code> functions.<br>
因此，在我们看来 <code>update</code> 需要两个参数，而实际上我们应该认为 <code>update</code> 至少需要两个参数。这同样适用于 <code>view</code> 和 <code>init</code> 函数。</p></div><div><p dir="auto">This idea is linked to the fact that a component’s <code>Model</code> should have all the information needed by the component, but this is not always true.<br>
这个想法与组件的 <code>Model</code> 应该拥有组件所需的所有信息有关，但这并不总是正确的。</p></div><div class="heading-wrapper"><h2 data-heading="Pass data as an argument" dir="auto" class="heading" id="Pass_data_as_an_argument"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Pass data as an argument</h2><div class="heading-children"><div><p dir="auto">将数据作为参数传递</p></div><div><p dir="auto">For example, if you have a session in your application in order to make HTTP calls, should you store this session in <strong>each component’s</strong> <code>Model</code> ?<br>
例如，如果您的应用程序中有一个会话用于进行 HTTP 调用，您是否应该将此会话存储在每个组件的 <code>Model</code> 中？<br>
<strong>No</strong>, you should store it at <strong>one place</strong> and then pass your session to the functions that need it.<br>
不，您应该将其存储在一个位置，然后将会话传递给需要它的函数。</p></div><div><p dir="auto">The next code illustrates this situation, we request a <code>session</code> argument in our init function because we need to make an authenticated http request using <code>Http.Auth.*</code> (custom module used, includes the session info in a request).<br>
下一个代码说明了这种情况，我们在 init 函数中请求 <code>session</code> 参数，因为我们需要使用 <code>Http.Auth.*</code> 发出经过身份验证的 http 请求（使用的自定义模块，包括会话信息要求）。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">open Elmish
open Fable.Import
open Fable.PowerPack

type Session = 
    { Token : string
      UserId : int }

type Model =
    | Loading
    | Loaded of string
    | Errored

type Msg =
    | OnFetchDataSuccess of string
    | OnFetchDataError of exn

let private fetchData (session : Session) : JS.Promise&lt;string&gt; =
    promise {
        let! res = Http.Auth.postRecord "/api/get-data" session
        return! res.text()
    }

let init (session : Session) =
    Loading, Cmd.ofPromise (fetchData session) OnFetchDataSuccess OnFetchDataError

let private update (msg : Msg) (model : Model) =
    match msg with
    | OnFetchDataSuccess value -&gt;
        Loaded value, Cmd.none

    | OnFetchDataError error -&gt;
        Browser.console.error error
        Errored, Cmd.none
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h2 data-heading="Pass a record as an argument" dir="auto" class="heading" id="Pass_a_record_as_an_argument"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Pass a record as an argument</h2><div class="heading-children"><div><p dir="auto">将记录作为参数传递</p></div><div><p dir="auto">If your view function takes several arguments you can use a record as an argument. It will force you to name the arguments and by doing so make your code easier to read and maintain over time.<br>
如果您的视图函数采用多个参数，您可以使用记录作为参数。它将迫使您命名参数，并通过这样做使您的代码随着时间的推移更易于阅读和维护。</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type private SectionProps =
    { Icon : Fa.IconOption
      Count : int
      Label : string
      IsActive : bool
      ZoneColor : string }
  
let private renderSection (props : SectionProps) =
    // Render the view
    
let view (model : Model) =
    renderSection 
        { Icon = Fa.Solid.Cog
          Count = model.ZoneA.Value + model.ZoneB.Value
          Label = model.Zone.Name
          IsActive = model.IsActive
          ZoneColor = findColor model.Zone.ColorIndex }
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">It will also make it easier to optimize your code for react using <code>memoBuilder</code>.<br>
它还将使使用 <code>memoBuilder</code> 更轻松地优化代码以进行反应</p></div><div><pre class="language-none" tabindex="0"><code class="language-F# language-none is-loaded">type private SectionProps =
    { Icon : Fa.IconOption
      Count : int
      Label : string
      IsActive : bool
      ZoneColor : string }
  
let private renderSection = 
    memoBuilder "Section" (fun (props : SectionProps) -&gt;
        // Render the view
    )
        
let view (model : Model) =
    renderSection 
        { Icon = Fa.Solid.Cog
          Count = model.ZoneA.Value + model.ZoneB.Value
          Label = model.Zone.Name
          IsActive = model.IsActive
          ZoneColor = findColor model.Zone.ColorIndex }
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h2 data-heading="Use helper function to work with your Domain" dir="auto" class="heading" id="Use_helper_function_to_work_with_your_Domain"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Use helper function to work with your Domain</h2><div class="heading-children"><div><p dir="auto">使用辅助函数来处理您的域</p></div><div><p dir="auto">For example, when an elmish component needs to fetch data from the server often, I like to show a loading animation. Here is how I handle it:<br>
例如，当一个精灵组件需要经常从服务器获取数据时，我喜欢显示加载动画。我是这样处理的：</p></div><div class="mod-footer"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Tips for working with Elmish"><div class="tree-item-contents heading-link" heading-name="Tips for working with Elmish"><span class="tree-item-title">Tips for working with Elmish</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Commands&nbsp;命令"><div class="tree-item-contents heading-link" heading-name="Commands&nbsp;命令"><span class="tree-item-title">Commands&nbsp;命令</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Basic_usage&nbsp;基本用法"><div class="tree-item-contents heading-link" heading-name="Basic usage&nbsp;基本用法"><span class="tree-item-title">Basic usage&nbsp;基本用法</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Modelize_your_Model_according_to_your_needs"><div class="tree-item-contents heading-link" heading-name="Modelize your Model according to your needs"><span class="tree-item-title">Modelize your Model according to your needs</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Everything_is_a_function&nbsp;一切都是函数"><div class="tree-item-contents heading-link" heading-name="Everything is a function&nbsp;一切都是函数"><span class="tree-item-title">Everything is a function&nbsp;一切都是函数</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Pass_data_as_an_argument"><div class="tree-item-contents heading-link" heading-name="Pass data as an argument"><span class="tree-item-title">Pass data as an argument</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Pass_a_record_as_an_argument"><div class="tree-item-contents heading-link" heading-name="Pass a record as an argument"><span class="tree-item-title">Pass a record as an argument</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/fsharp/tips-for-working-with-elmish.html#Use_helper_function_to_work_with_your_Domain"><div class="tree-item-contents heading-link" heading-name="Use helper function to work with your Domain"><span class="tree-item-title">Use helper function to work with your Domain</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>