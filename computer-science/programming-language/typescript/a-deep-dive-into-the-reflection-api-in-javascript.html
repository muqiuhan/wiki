<!DOCTYPE html> <html><head>
		<title>A Deep Dive into the Reflection API in Javascript</title>
		<base href="../../../">
		<meta id="root-path" root-path="../../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="韩暮秋的个人维基 - A Deep Dive into the Reflection API in Javascript">
		<meta property="og:title" content="A Deep Dive into the Reflection API in Javascript">
		<meta property="og:description" content="韩暮秋的个人维基 - A Deep Dive into the Reflection API in Javascript">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://muqiuhan.github.io/wiki/computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="韩暮秋的个人维基">
		<meta name="author" content="韩暮秋"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="lib/scripts/pixi.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="lib/scripts/minisearch.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.jpg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon oled-black lst-fab-b2-1 is-css-guide list-d-c-d lst-fm-compact lst-prop-super-compact"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="What is Reflection API in programming?"><p dir="auto">What is Reflection API in programming?</p></h1><div><p dir="auto"><a href="?query=tag:javascript" class="tag" target="_blank" rel="noopener">#javascript</a> <a href="?query=tag:typescript" class="tag" target="_blank" rel="noopener">#typescript</a></p></div><div><p dir="auto">Before talking about Reflection API in JavaScript, let’s review some general concepts to understand better.</p></div><div class="heading-wrapper"><div class="heading-children"><div><p dir="auto">The Reflection API in programming refers to a set of built-in tools and capabilities within a programming language that allows a program to inspect and manipulate its own structure, behavior, and metadata during runtime. Reflection enables the examination of classes, interfaces, methods, and fields at runtime without knowing their names at compile time.</p></div><div><p dir="auto">Key functionalities provided by Reflection API typically include:</p></div><div><ol>
<li data-line="0" dir="auto">Inspecting Classes: Reflection allows you to examine the structure of classes, including fields, methods, constructors, and annotations associated with them.</li>
<li data-line="1" dir="auto">Instantiating Classes Dynamically: With reflection, you can create instances of classes dynamically at runtime, even if you don’t know the class name at compile time.</li>
<li data-line="2" dir="auto">Invoking Methods Dynamically: You can invoke methods on objects dynamically without knowing their names at compile time.</li>
<li data-line="3" dir="auto">Accessing and Modifying Fields: Reflection provides the ability to access and modify fields of classes, including private fields, which are otherwise not accessible.</li>
<li data-line="4" dir="auto">Examining Annotations: You can inspect annotations associated with classes, methods, fields, etc., and take appropriate actions based on their presence or values. And even more!</li>
</ol></div></div></div><div class="heading-wrapper"><h1 data-heading="Some examples in JavaScript" dir="auto" class="heading" id="Some_examples_in_JavaScript">Some examples in JavaScript</h1><div class="heading-children"><div><p dir="auto">Now let’s see some examples in JavaScript:</p></div><div><ol>
<li data-line="0" dir="auto">Inspecting Object Properties: You can use <code>for...in</code> loop or <code>Object.keys()</code> to iterate over the properties of an object dynamically:</li>
</ol></div><div><pre class="language-javascript" tabindex="0"><code class="language-javascript is-loaded"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">'New York'</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
<span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0" dir="auto">Accessing and Modifying Object Properties Dynamically: You can access and modify object properties dynamically using square bracket notation:</li>
</ol></div><div><pre class="language-javascript" tabindex="0"><code class="language-javascript is-loaded"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
<span class="token comment">// Accessing property dynamically  </span>
<span class="token keyword">const</span> propertyName <span class="token operator">=</span> <span class="token string">'name'</span><span class="token punctuation">;</span>  
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: John  </span>
  
<span class="token comment">// Modifying property dynamically  </span>
<span class="token keyword">const</span> newValue <span class="token operator">=</span> <span class="token string">'Jane'</span><span class="token punctuation">;</span>  
obj<span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">;</span>  
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: Jane</span>

<span class="token number">3.</span> <span class="token maybe-class-name">Invoking</span> <span class="token maybe-class-name">Methods</span> <span class="token maybe-class-name">Dynamically</span><span class="token operator">:</span> <span class="token maybe-class-name">JavaScript</span> allows you to invoke object methods dynamically using square bracket notation<span class="token operator">:</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  
    <span class="token function-variable function">greet</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
<span class="token keyword">const</span> methodName <span class="token operator">=</span> <span class="token string">'greet'</span><span class="token punctuation">;</span>  
obj<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: Hello!</span>
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h1 data-heading="Limitations of the Reflection API in JavaScript" dir="auto" class="heading" id="Limitations_of_the_Reflection_API_in_JavaScript">Limitations of the Reflection API in JavaScript</h1><div class="heading-children"><div><p dir="auto">In JavaScript, compared to languages like Java or C#, there are certain reflection capabilities that are not directly available or are more limited:</p></div><div><ol>
<li data-line="0" dir="auto">Strict Typing: JavaScript is dynamically typed, which means types are determined at runtime. In Java and C#, reflection can be used to inspect and manipulate types at compile time due to their static typing nature. This means that in JavaScript, you may not have as much compile-time safety when using reflection-like features.</li>
<li data-line="1" dir="auto">Type Metadata: Java and C# have extensive metadata available at runtime due to their static typing nature and rich type systems. In JavaScript, since types are determined dynamically, there is less type metadata available at runtime.</li>
<li data-line="2" dir="auto">Reflection Emit: In languages like C#, you can use reflection emit to generate IL (Intermediate Language) code dynamically at runtime and execute it. JavaScript does not have a direct equivalent to IL code or the ability to emit and execute code dynamically at runtime in the same manner.</li>
<li data-line="3" dir="auto">Annotations and Attributes: Java and C# support annotations and attributes, respectively, which can be used to add metadata to types, methods, and fields. While JavaScript has something similar in the form of decorators (with TypeScript or Babel), they are not as deeply integrated into the language and runtime as annotations in Java or attributes in C#.</li>
</ol></div><div><p dir="auto">Overall, while JavaScript provides some level of reflection-like capabilities, its dynamic nature and design differences mean that certain features available in statically-typed languages like Java or C# are not directly possible or are more limited in JavaScript.</p></div></div></div><div class="heading-wrapper"><h1 data-heading="Reflect-Metadata in JS / TS (Problem)" dir="auto" class="heading" id="Reflect-Metadata_in_JS_/_TS_(Problem)">Reflect-Metadata in JS / TS (Problem)</h1><div class="heading-children"><div><p dir="auto">There are some packages that solves some of the limitations. <code>Reflect-Metadata</code> is one of them.</p></div><div><p dir="auto">Before seeing what Reflect-Metadata is, let’s see what the problem is!</p></div><div class="heading-wrapper"><h2 data-heading="The problem:" dir="auto" class="heading" id="The_problem:"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>The problem:</h2><div class="heading-children"><div><p dir="auto">Let’s say we want to disregard users who don’t have permission to a certain API. We can implement in this way:</p></div><div><pre class="language-javascript" tabindex="0"><code class="language-javascript is-loaded"><span class="token keyword">function</span> <span class="token function">adminOnlyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token property-access">role</span> <span class="token operator">===</span> roles<span class="token punctuation">.</span><span class="token constant">ADMIN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"This method is only for admins."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">// Perform admin-specific actions  </span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>  
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"You don't have permission to perform this action."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">// Optionally, handle lack of permissions  </span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token maybe-class-name">But</span> what <span class="token keyword control-flow">if</span> we have one hundred <span class="token maybe-class-name">APIs</span><span class="token operator">?</span> <span class="token maybe-class-name">Do</span> we want to implement <span class="token keyword">this</span> logic each time<span class="token operator">?</span> <span class="token maybe-class-name">The</span> answer is no<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">But</span></span> still<span class="token punctuation">,</span> we can accomplish acceptable ways without the need <span class="token keyword control-flow">for</span> <span class="token maybe-class-name">Reflection</span> <span class="token constant">API</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">To</span></span> achieve a more declarative approach and avoid checking roles <span class="token keyword">in</span> every <span class="token keyword">function</span><span class="token punctuation">,</span> you can use a higher<span class="token operator">-</span>order <span class="token keyword">function</span> or a middleware<span class="token operator">-</span>like pattern to wrap your methods <span class="token keyword">with</span> role<span class="token operator">-</span>based access control logic<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">Here’s</span></span> an example using a higher<span class="token operator">-</span>order <span class="token keyword">function</span><span class="token operator">:</span>

<span class="token comment">// Higher-order function to create role-restricted methods  </span>
<span class="token keyword">function</span> <span class="token function">restrictToRole</span><span class="token punctuation">(</span><span class="token parameter">role<span class="token punctuation">,</span> method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword control-flow">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token property-access">role</span> <span class="token operator">===</span> role<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword control-flow">return</span> method<span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Execute the original method  </span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>  
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"You don't have permission to perform this action."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment">// Optionally, handle lack of permissions  </span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">// Example method  </span>
<span class="token keyword">function</span> <span class="token function">adminOnlyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"This method is only for admins."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token comment">// Perform admin-specific actions  </span>
<span class="token punctuation">}</span>  
  
<span class="token comment">// Wrap the method with role-based access control  </span>
<span class="token keyword">const</span> restrictedAdminMethod <span class="token operator">=</span> <span class="token function">restrictToRole</span><span class="token punctuation">(</span>roles<span class="token punctuation">.</span><span class="token constant">ADMIN</span><span class="token punctuation">,</span> adminOnlyMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">This is not too bad! But <strong>still not the best option</strong>! Here is where Reflect-Metadata comes into place.</p></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="How does Reflect-Metadata work?" dir="auto" class="heading" id="How_does_Reflect-Metadata_work?">How does Reflect-Metadata work?</h1><div class="heading-children"><div><p dir="auto"><code>reflect-metadata</code> is a library in JavaScript and TypeScript that provides reflection metadata API for runtime reflection capabilities. It enables developers to add and read metadata to/from class declarations and members at runtime.</p></div><div><p dir="auto">Here’s a brief overview of how <code>reflect-metadata</code> works:</p></div><div><ol>
<li data-line="0" dir="auto">Adding Metadata: Developers can use <code>Reflect.metadata()</code> to add metadata to class declarations, methods, or properties. Metadata is added using a metadata key and a metadata value.</li>
<li data-line="1" dir="auto">Accessing Metadata: The library provides methods such as <code>Reflect.getMetadata()</code> to retrieve metadata associated with class declarations, methods, or properties at runtime.</li>
<li data-line="2" dir="auto">Usage in TypeScript: <code>reflect-metadata</code> is often used in conjunction with TypeScript decorators. Decorators allow developers to add metadata to classes and members in a more intuitive and declarative way.</li>
<li data-line="3" dir="auto">Runtime Reflection: With the help of <code>reflect-metadata</code>, developers can perform runtime reflection tasks such as dependency injection, serialization, validation, and more.</li>
</ol></div><div><p dir="auto">Here’s a simple example of using <code>reflect-metadata</code> with TypeScript decorators:</p></div><div><pre class="language-typescript" tabindex="0"><code class="language-typescript is-loaded"><span class="token keyword">import</span> <span class="token string">'reflect-metadata'</span><span class="token punctuation">;</span>  
  
<span class="token comment">// Define a decorator function  </span>
<span class="token keyword">function</span> <span class="token function">MyDecorator</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token comment">// Add metadata to the target (class) with the given key  </span>
  Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token string">'customMetadataKey'</span><span class="token punctuation">,</span> <span class="token string">'someValue'</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>  
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">MyDecorator</span></span>  
  <span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">// Retrieve metadata at runtime  </span>
<span class="token keyword">const</span> metadataValue <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token string">'customMetadataKey'</span><span class="token punctuation">,</span> MyClass<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'myMethod'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>metadataValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: 'someValue'</span>
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h1 data-heading="Solve the issue with Reflect-Metadata" dir="auto" class="heading" id="Solve_the_issue_with_Reflect-Metadata">Solve the issue with Reflect-Metadata</h1><div class="heading-children"><div><p dir="auto">What if you solve the problem with a decorator?</p></div><div><pre class="language-typescript" tabindex="0"><code class="language-typescript is-loaded"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>  
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Public</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Request</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> req<span class="token operator">:</span> UserRequest<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>LoginResponseDto<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">We define a <code>@Public</code> decorator as follows (I did it in NestJS which abstracts the same lib):</p></div><div><pre class="language-typescript" tabindex="0"><code class="language-typescript is-loaded"><span class="token keyword">import</span> <span class="token punctuation">{</span> SetMetadata <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>  
  
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">IS_PUBLIC_KEY</span> <span class="token operator">=</span> <span class="token string">'isPublic'</span><span class="token punctuation">;</span>  
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Public</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">SetMetadata</span><span class="token punctuation">(</span><span class="token constant">IS_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Now <span class="token keyword">in</span> my Guard<span class="token punctuation">,</span> <span class="token constant">I</span> can check <span class="token keyword">if</span> the current <span class="token constant">API</span> <span class="token keyword">is</span> decorated <span class="token keyword">with</span> the given metadata key or not<span class="token operator">:</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JwtAuthGuard</span> <span class="token keyword">extends</span> <span class="token class-name">AuthGuard</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> reflector<span class="token operator">:</span> Reflector<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
  
  <span class="token function">canActivate</span><span class="token punctuation">(</span>context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token comment">// we pass IS_PUBLIC_KEY as metadata key to see  </span>
    <span class="token comment">// if the method is decorated with that  </span>
    <span class="token keyword">const</span> isPublic <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reflector<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getAllAndOverride</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token constant">IS_PUBLIC_KEY</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  
      context<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
      context<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isPublic<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">canActivate</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">This is a more declarative way and reduces code duplication!</p></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#What is Reflection API in programming?"><div class="tree-item-contents heading-link" heading-name="What is Reflection API in programming?"><span class="tree-item-title">What is Reflection API in programming?</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#Some_examples_in_JavaScript"><div class="tree-item-contents heading-link" heading-name="Some examples in JavaScript"><span class="tree-item-title">Some examples in JavaScript</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#Limitations_of_the_Reflection_API_in_JavaScript"><div class="tree-item-contents heading-link" heading-name="Limitations of the Reflection API in JavaScript"><span class="tree-item-title">Limitations of the Reflection API in JavaScript</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#Reflect-Metadata_in_JS_/_TS_(Problem)"><div class="tree-item-contents heading-link" heading-name="Reflect-Metadata in JS / TS (Problem)"><span class="tree-item-title">Reflect-Metadata in JS / TS (Problem)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#The_problem:"><div class="tree-item-contents heading-link" heading-name="The problem:"><span class="tree-item-title">The problem:</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#How_does_Reflect-Metadata_work?"><div class="tree-item-contents heading-link" heading-name="How does Reflect-Metadata work?"><span class="tree-item-title">How does Reflect-Metadata work?</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/programming-language/typescript/a-deep-dive-into-the-reflection-api-in-javascript.html#Solve_the_issue_with_Reflect-Metadata"><div class="tree-item-contents heading-link" heading-name="Solve the issue with Reflect-Metadata"><span class="tree-item-title">Solve the issue with Reflect-Metadata</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>