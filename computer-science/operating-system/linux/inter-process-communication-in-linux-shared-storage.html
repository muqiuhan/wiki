<!DOCTYPE html> <html><head>
		<title>Inter-process communication in Linux -- Shared storage</title>
		<base href="../../../">
		<meta id="root-path" root-path="../../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="韩暮秋的个人维基 - Inter-process communication in Linux -- Shared storage">
		<meta property="og:title" content="Inter-process communication in Linux -- Shared storage">
		<meta property="og:description" content="韩暮秋的个人维基 - Inter-process communication in Linux -- Shared storage">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://muqiuhan.github.io/wiki/computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="韩暮秋的个人维基">
		<meta name="author" content="韩暮秋"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="lib/scripts/pixi.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="lib/scripts/minisearch.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.jpg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon oled-black lst-fab-b2-1 is-css-guide list-d-c-d lst-fm-compact lst-prop-super-compact"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Inter-process communication in Linux -- Shared storage"><p dir="auto">Inter-process communication in Linux -- Shared storage</p></h1><div><p dir="auto"><a href="?query=tag:linux" class="tag" target="_blank" rel="noopener">#linux</a> <a href="?query=tag:os" class="tag" target="_blank" rel="noopener">#os</a></p></div><div><p dir="auto">This is the first article in a series&nbsp;about <a data-tooltip-position="top" aria-label="https://en.wikipedia.org/wiki/Inter-process_communication" rel="noopener" class="external-link" href="https://en.wikipedia.org/wiki/Inter-process_communication" target="_blank">interprocess communication</a> (IPC) in Linux. The series uses code examples in C to clarify the following IPC mechanisms:</p></div><div><ul>
<li data-line="0" dir="auto">Shared files</li>
<li data-line="1" dir="auto">Shared memory (with semaphores)</li>
<li data-line="2" dir="auto">Pipes (named and unnamed)</li>
<li data-line="3" dir="auto">Message queues</li>
<li data-line="4" dir="auto">Sockets</li>
<li data-line="5" dir="auto">Signals</li>
</ul></div><div><p dir="auto">This article reviews some core concepts before moving on to the first two of these mechanisms: shared files and shared memory.</p></div><div class="heading-wrapper"><h2 data-heading="Core concepts" dir="auto" class="heading" id="Core_concepts"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Core concepts</h2><div class="heading-children"><div><p dir="auto">A <em>process</em> is a program in execution, and each process has its own address space, which comprises the memory locations that the process is allowed to access. A process has one or more <em>threads</em> of execution, which are sequences of executable instructions: a <em>single-threaded</em> process has just one thread, whereas a <em>multi-threaded</em> process has more than one thread. Threads within a process share various resources, in particular, address space. Accordingly, threads within a process can communicate straightforwardly through shared memory, although some modern languages (e.g., Go) encourage a more disciplined approach such as the use of thread-safe channels. Of interest here is that different processes, by default, do <em>not</em> share memory.</p></div><div><p dir="auto">There are various ways to launch processes that then communicate, and two ways dominate in the examples that follow:</p></div><div><ul>
<li data-line="0" dir="auto">A terminal is used to start one process, and perhaps a different terminal is used to start another.</li>
<li data-line="1" dir="auto">The system function <strong>fork</strong> is called within one process (the parent) to spawn another process (the child).</li>
</ul></div><div><p dir="auto">The first examples take the terminal approach. The <a data-tooltip-position="top" aria-label="http://condor.depaul.edu/mkalin" rel="noopener" class="external-link" href="http://condor.depaul.edu/mkalin" target="_blank">code examples</a> are available in a ZIP file on my website.</p></div></div></div><div class="heading-wrapper"><h2 data-heading="Shared files" dir="auto" class="heading" id="Shared_files"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Shared files</h2><div class="heading-children"><div><p dir="auto">Programmers are all too familiar with file access, including the many pitfalls (non-existent files, bad file permissions, and so on) that beset the use of files in programs. Nonetheless, shared files may be the most basic IPC mechanism. Consider the relatively simple case in which one process (<em>producer</em>) creates and writes to a file, and another process (<em>consumer</em>) reads from this same file:</p></div><div><pre class="language-text" tabindex="0"><code class="language-text is-loaded">         writes  +-----------+  reads
producer--------&gt;| disk file |&lt;-------consumer
                 +-----------+
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">The obvious challenge in using this IPC mechanism is that a <em>race condition</em> might arise: the producer and the consumer might access the file at exactly the same time, thereby making the outcome indeterminate. To avoid a race condition, the file must be locked in a way that prevents a conflict between a <em>write</em> operation and any another operation, whether a <em>read</em> or a <em>write</em>. The locking API in the standard system library can be summarized as follows:</p></div><div><ul>
<li data-line="0" dir="auto">A producer should gain an exclusive lock on the file before writing to the file. An <em>exclusive</em> lock can be held by one process at most, which rules out a race condition because no other process can access the file until the lock is released.</li>
<li data-line="1" dir="auto">A consumer should gain at least a shared lock on the file before reading from the file. Multiple <em>readers</em> can hold a <em>shared</em> lock at the same time, but no <em>writer</em> can access a file when even a single <em>reader</em> holds a shared lock.</li>
</ul></div><div><p dir="auto">A shared lock promotes efficiency. If one process is just reading a file and not changing its contents, there is no reason to prevent other processes from doing the same. Writing, however, clearly demands exclusive access to a file.</p></div><div><p dir="auto">The standard I/O library includes a utility function named <strong>fcntl</strong> that can be used to inspect and manipulate both exclusive and shared locks on a file. The function works through a <em>file descriptor</em>, a non-negative integer value that, within a process, identifies a file. (Different file descriptors in different processes may identify the same physical file.) For file locking, Linux provides the library function <strong>flock</strong>, which is a thin wrapper around <strong>fcntl</strong>. The first example uses the <strong>fcntl</strong> function to expose API details.</p></div><div class="heading-wrapper"><h3 data-heading="Example 1. The _producer_ program" dir="auto" class="heading" id="Example_1._The__producer__program"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Example 1. The <em>producer</em> program</h3><div class="heading-children"><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FileName</span> <span class="token string">"data.dat"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DataString</span> <span class="token string">"Now is the winter of our discontent\nMade glorious summer by this sun of York\n"</span></span>

<span class="token keyword">void</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">perror</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* EXIT_FAILURE */</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">flock</span> lock<span class="token punctuation">;</span>
  lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_WRLCK<span class="token punctuation">;</span>    <span class="token comment">/* read/write (exclusive versus shared) lock */</span>
  lock<span class="token punctuation">.</span>l_whence <span class="token operator">=</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">;</span> <span class="token comment">/* base for seek offsets */</span>
  lock<span class="token punctuation">.</span>l_start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">/* 1st byte in file */</span>
  lock<span class="token punctuation">.</span>l_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>           <span class="token comment">/* 0 here means 'until EOF' */</span>
  lock<span class="token punctuation">.</span>l_pid <span class="token operator">=</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* process id */</span>

  <span class="token keyword">int</span> fd<span class="token punctuation">;</span> <span class="token comment">/* file descriptor to identify a file within a process */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>FileName<span class="token punctuation">,</span> O_RDWR <span class="token operator">|</span> O_CREAT<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">/* -1 signals an error */</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"open failed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_SETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/** F_SETLK doesn't block, F_SETLKW does **/</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"fcntl failed to get lock..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> DataString<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>DataString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* populate data file */</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Process %d has written to data file...\n"</span><span class="token punctuation">,</span> lock<span class="token punctuation">.</span>l_pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* Now release the lock explicitly. */</span>
  lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_UNLCK<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_SETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"explicit unlocking failed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* close the file: would unlock if needed */</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">/* terminating the process would unlock as well */</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">The main steps in the <em>producer</em> program above can be summarized as follows:</p></div><div><ul>
<li data-line="0" dir="auto">The program declares a variable of type <strong>struct flock</strong>, which represents a lock, and initializes the structure's five fields. The first initialization:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded">lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_WRLCK<span class="token punctuation">;</span> <span class="token comment">/* exclusive lock */</span>
</code><button class="copy-code-button">Copy</button></pre>
  makes the lock an exclusive (<em>read-write</em>) rather than a shared (<em>read-only</em>) lock. If the <em>producer</em> gains the lock, then no other process will be able to write or read the file until the <em>producer</em> releases the lock, either explicitly with the appropriate call to <strong>fcntl</strong> or implicitly by closing the file. (When the process terminates, any opened files would be closed automatically, thereby releasing the lock.)<br>
</li>
<li data-line="8" dir="auto">The program then initializes the remaining fields. The chief effect is that the <em>entire</em> file is to be locked. However, the locking API allows only designated bytes to be locked. For example, if the file contains multiple text records, then a single record (or even part of a record) could be locked and the rest left unlocked.</li>
<li data-line="9" dir="auto">The first call to <strong>fcntl</strong>:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_SETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre>
  tries to lock the file exclusively, checking whether the call succeeded. In general, the <strong>fcntl</strong> function returns <strong>-1</strong> (hence, less than zero) to indicate failure. The second argument <strong>F_SETLK</strong> means that the call to <strong>fcntl</strong> does <em>not</em> block: the function returns immediately, either granting the lock or indicating failure. If the flag <strong>F_SETLKW</strong> (the <strong>W</strong> at the end is for <em>wait</em>) were used instead, the call to <strong>fcntl</strong> would block until gaining the lock was possible. In the calls to <strong>fcntl</strong>, the first argument <strong>fd</strong> is the file descriptor, the second argument specifies the action to be taken (in this case,&nbsp;<strong>F_SETLK</strong> for setting the lock), and the third argument is the address of the lock structure (in this case,&nbsp;<strong>&amp;lock</strong>).<br>
</li>
<li data-line="17" dir="auto">If the <em>producer</em> gains the lock, the program writes two text records to the file.</li>
<li data-line="18" dir="auto">After writing to the file, the <em>producer</em> changes the lock structure's <strong>l_type</strong> field to the <em>unlock</em> value:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded">lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_UNLCK<span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre>
  and calls <strong>fcntl</strong> to perform the unlocking operation. The program finishes up by closing the file and exiting.<br>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="Example 2. The _consumer_ program" dir="auto" class="heading" id="Example_2._The__consumer__program"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Example 2. The <em>consumer</em> program</h3><div class="heading-children"><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FileName</span> <span class="token string">"data.dat"</span></span>

<span class="token keyword">void</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">perror</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* EXIT_FAILURE */</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">flock</span> lock<span class="token punctuation">;</span>
  lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_WRLCK<span class="token punctuation">;</span>    <span class="token comment">/* read/write (exclusive) lock */</span>
  lock<span class="token punctuation">.</span>l_whence <span class="token operator">=</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">;</span> <span class="token comment">/* base for seek offsets */</span>
  lock<span class="token punctuation">.</span>l_start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">/* 1st byte in file */</span>
  lock<span class="token punctuation">.</span>l_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>           <span class="token comment">/* 0 here means 'until EOF' */</span>
  lock<span class="token punctuation">.</span>l_pid <span class="token operator">=</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* process id */</span>

  <span class="token keyword">int</span> fd<span class="token punctuation">;</span> <span class="token comment">/* file descriptor to identify a file within a process */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>FileName<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">/* -1 signals an error */</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"open to read failed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* If the file is write-locked, we can't continue. */</span>
  <span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_GETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* sets lock.l_type to F_UNLCK if no write lock */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span>l_type <span class="token operator">!=</span> F_UNLCK<span class="token punctuation">)</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"file is still write locked..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_RDLCK<span class="token punctuation">;</span> <span class="token comment">/* prevents any writing during the reading */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_SETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"can't get a read-only lock..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Read the bytes (they happen to be ASCII codes) one at a time. */</span>
  <span class="token keyword">int</span> c<span class="token punctuation">;</span> <span class="token comment">/* buffer for read bytes */</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment">/* 0 signals EOF */</span>
    <span class="token function">write</span><span class="token punctuation">(</span>STDOUT_FILENO<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* write one byte to the standard output */</span>

  <span class="token comment">/* Release the lock explicitly. */</span>
  lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_UNLCK<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_SETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"explicit unlocking failed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">The <em>consumer</em> program is more complicated than necessary to highlight features of the locking API. In particular, the <em>consumer</em> program first checks whether the file is exclusively locked and only then tries to gain a shared lock. The relevant code is:</p></div><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded">lock<span class="token punctuation">.</span>l_type <span class="token operator">=</span> F_WRLCK<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">fcntl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> F_GETLK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* sets lock.l_type to F_UNLCK if no write lock */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span>l_type <span class="token operator">!=</span> F_UNLCK<span class="token punctuation">)</span>
  <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"file is still write locked..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">The <strong>F_GETLK</strong> operation specified in the <strong>fcntl</strong> call checks for a lock, in this case, an exclusive lock given as <strong>F_WRLCK</strong> in the first statement above. If the specified lock does not exist, then the <strong>fcntl</strong> call automatically changes the lock type field to <strong>F_UNLCK</strong> to indicate this fact. If the file is exclusively locked, the <em>consumer</em> terminates. (A more robust version of the program might have the <em>consumer</em> <strong>sleep</strong> a bit and try again several times.)</p></div><div><p dir="auto">If the file is not currently locked, then the <em>consumer</em> tries to gain a shared (<em>read-only</em>) lock (<strong>F_RDLCK</strong>). To shorten the program, the <strong>F_GETLK</strong> call to <strong>fcntl</strong> could be dropped because the <strong>F_RDLCK</strong> call would fail if a <em>read-write</em> lock already were held by some other process. Recall that a <em>read-only</em> lock does prevent any other process from writing to the file, but allows other processes to read from the file. In short, a <em>shared</em> lock can be held by multiple processes. After gaining a shared lock, the <em>consumer</em> program reads the bytes one at a time from the file, prints the bytes to the standard output, releases the lock, closes the file, and terminates.</p></div><div><p dir="auto">Here is the output from the two programs launched from the same terminal with <strong>%</strong> as the command line prompt:</p></div><div><pre class="language-text" tabindex="0"><code class="language-text is-loaded">% ./producer
Process 29255 has written to data file...

% ./consumer
Now is the winter of our discontent
Made glorious summer by this sun of York
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">In this first code example, the data shared through IPC is text: two lines from Shakespeare's play <em>Richard III</em>. Yet, the shared file's contents could be voluminous, arbitrary bytes (e.g., a digitized movie), which makes file sharing an impressively flexible IPC mechanism. The downside is that file access is relatively slow, whether the access involves reading or writing. As always, programming comes with tradeoffs. The next example has the upside of IPC through shared memory, rather than shared files, with a corresponding boost in performance.</p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="Shared memory" dir="auto" class="heading" id="Shared_memory"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Shared memory</h2><div class="heading-children"><div><p dir="auto">Linux systems provide two separate APIs for shared memory: the legacy System V API and the more recent POSIX one. These APIs should never be mixed in a single application, however. A downside of the POSIX approach is that features are still in development and dependent upon the installed kernel version, which impacts code portability. For example, the POSIX API, by default, implements shared memory as a <em>memory-mapped file</em>: for a shared memory segment, the system maintains a <em>backing file</em> with corresponding contents. Shared memory under POSIX can be configured without a backing file, but this may impact portability. My example uses the POSIX API with a backing file, which combines the benefits of memory access (speed) and file storage (persistence).</p></div><div><p dir="auto">The shared-memory example has two programs, named <em>memwriter</em> and <em>memreader</em>, and uses a <em>semaphore</em> to coordinate their access to the shared memory. Whenever shared memory comes into the picture with a <em>writer</em>, whether in multi-processing or multi-threading, so does the risk of a memory-based race condition; hence, the semaphore is used to coordinate (synchronize) access to the shared memory.</p></div><div><p dir="auto">The <em>memwriter</em> program should be started first in its own terminal. The <em>memreader</em> program then can be started (within a dozen seconds) in its own terminal. The output from the <em>memreader</em> is:</p></div><div><pre class="language-text" tabindex="0"><code class="language-text is-loaded">This is the way the world ends...
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Each source file has documentation at the top explaining the link flags to be included during compilation.</p></div><div><p dir="auto">Let's start with a review of how semaphores work as a synchronization mechanism. A general semaphore also is called a <em>counting semaphore</em>, as it has a value (typically initialized to zero) that can be incremented. Consider a shop that rents bicycles, with a hundred of them in stock, with a program that clerks use to do the rentals. Every time a bike is rented, the semaphore is incremented by one; when a bike is returned, the semaphore is decremented by one. Rentals can continue until the value hits 100 but then must halt until at least one bike is returned, thereby decrementing the semaphore to 99.</p></div><div><p dir="auto">A <em>binary semaphore</em> is a special case requiring only two values: 0 and 1. In this situation, a semaphore acts as a <em>mutex</em>: a mutual exclusion construct. The shared-memory example uses a semaphore as a mutex. When the semaphore's value is 0, the <em>memwriter</em> alone can access the shared memory. After writing, this process increments the semaphore's value, thereby allowing the <em>memreader</em> to read the shared memory.</p></div><div class="heading-wrapper"><h3 data-heading="Example 3. Source code for the _memwriter_ process" dir="auto" class="heading" id="Example_3._Source_code_for_the__memwriter__process"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Example 3. Source code for the <em>memwriter</em> process</h3><div class="heading-children"><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token comment">/** Compilation: gcc -o memwriter memwriter.c -lrt -lpthread **/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;semaphore.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"shmem.h"</span></span>

<span class="token keyword">void</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">perror</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">shm_open</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">,</span>      <span class="token comment">/* name from smem.h */</span>
                    O_RDWR <span class="token operator">|</span> O_CREAT<span class="token punctuation">,</span> <span class="token comment">/* read/write, create if needed */</span>
                    AccessPerms<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">/* access permissions (0644) */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"Can't open shared mem segment..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">ftruncate</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> ByteSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* get the bytes */</span>

  <span class="token class-name">caddr_t</span> memptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span>       <span class="token comment">/* let system pick where to put segment */</span>
                        ByteSize<span class="token punctuation">,</span>   <span class="token comment">/* how many bytes */</span>
                        PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> <span class="token comment">/* access protections */</span>
                        MAP_SHARED<span class="token punctuation">,</span> <span class="token comment">/* mapping visible to other processes */</span>
                        fd<span class="token punctuation">,</span>         <span class="token comment">/* file descriptor */</span>
                        <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">/* offset: start at 1st byte */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">caddr_t</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token operator">==</span> memptr<span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"Can't get segment..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"shared mem address: %p [0..%d]\n"</span><span class="token punctuation">,</span> memptr<span class="token punctuation">,</span> ByteSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"backing file:       /dev/shm%s\n"</span><span class="token punctuation">,</span> BackingFile <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* semaphore code to lock the shared mem */</span>
  <span class="token class-name">sem_t</span><span class="token operator">*</span> semptr <span class="token operator">=</span> <span class="token function">sem_open</span><span class="token punctuation">(</span>SemaphoreName<span class="token punctuation">,</span> <span class="token comment">/* name */</span>
                           O_CREAT<span class="token punctuation">,</span>       <span class="token comment">/* create the semaphore */</span>
                           AccessPerms<span class="token punctuation">,</span>   <span class="token comment">/* protection perms */</span>
                           <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* initial value */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>semptr <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"sem_open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">strcpy</span><span class="token punctuation">(</span>memptr<span class="token punctuation">,</span> MemContents<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* copy some ASCII bytes to the segment */</span>

  <span class="token comment">/* increment the semaphore so that memreader can read */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sem_post</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"sem_post"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* give reader a chance */</span>

  <span class="token comment">/* clean up */</span>
  <span class="token function">munmap</span><span class="token punctuation">(</span>memptr<span class="token punctuation">,</span> ByteSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* unmap the storage */</span>
  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sem_close</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">shm_unlink</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* unlink from the backing file */</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Here's an overview of how the <em>memwriter</em> and <em>memreader</em> programs communicate through shared memory:</p></div><div><ul>
<li data-line="0" dir="auto">The <em>memwriter</em> program, shown above, calls the <strong>shm_open</strong> function to get a file descriptor for the backing file that the system coordinates with the shared memory. At this point, no memory has been allocated. The subsequent call to the misleadingly named function <strong>ftruncate</strong>:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token function">ftruncate</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> ByteSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* get the bytes */</span>
</code><button class="copy-code-button">Copy</button></pre>
  allocates <strong>ByteSize</strong> bytes, in this case, a modest 512 bytes. The <em>memwriter</em> and <em>memreader</em> programs access the shared memory only, not the backing file. The system is responsible for synchronizing the shared memory and the backing file.<br>
</li>
<li data-line="8" dir="auto">The <em>memwriter</em> then calls the <strong>mmap</strong> function:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token class-name">caddr_t</span> memptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span>       <span class="token comment">/* let system pick where to put segment */</span>
                      ByteSize<span class="token punctuation">,</span>   <span class="token comment">/* how many bytes */</span>
                      PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> <span class="token comment">/* access protections */</span>
                      MAP_SHARED<span class="token punctuation">,</span> <span class="token comment">/* mapping visible to other processes */</span>
                      fd<span class="token punctuation">,</span>         <span class="token comment">/* file descriptor */</span>
                      <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">/* offset: start at 1st byte */</span>
</code><button class="copy-code-button">Copy</button></pre>
  to get a pointer to the shared memory. (The <em>memreader</em> makes a similar call.) The pointer type <strong>caddr_t</strong> starts with a <strong>c</strong> for <strong>calloc</strong>, a system function that initializes dynamically allocated storage to zeroes. The <em>memwriter</em> uses the <strong>memptr</strong> for the later <em>write</em> operation, using the library <strong>strcpy</strong> (string copy) function.<br>
</li>
<li data-line="21" dir="auto">At this point, the <em>memwriter</em> is ready for writing, but it first creates a semaphore to ensure exclusive access to the shared memory. A race condition would occur if the <em>memwriter</em> were writing while the <em>memreader</em> was reading. If the call to <strong>sem_open</strong> succeeds:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token class-name">sem_t</span><span class="token operator">*</span> semptr <span class="token operator">=</span> <span class="token function">sem_open</span><span class="token punctuation">(</span>SemaphoreName<span class="token punctuation">,</span> <span class="token comment">/* name */</span>
                         O_CREAT<span class="token punctuation">,</span>       <span class="token comment">/* create the semaphore */</span>
                         AccessPerms<span class="token punctuation">,</span>   <span class="token comment">/* protection perms */</span>
                         <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* initial value */</span>
</code><button class="copy-code-button">Copy</button></pre>
  then the writing can proceed. The <strong>SemaphoreName</strong> (any unique non-empty name will do) identifies the semaphore in both the <em>memwriter</em> and the <em>memreader</em>. The initial value of zero gives the semaphore's creator, in this case,&nbsp;the <em>memwriter</em>, the right to proceed, in this case, to the <em>write</em> operation.<br>
</li>
<li data-line="32" dir="auto">After writing, the <em>memwriter</em> increments the semaphore value to 1:  
<pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sem_post</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
</code><button class="copy-code-button">Copy</button></pre>
  with a call to the <strong>sem_post</strong> function. Incrementing the semaphore releases the mutex lock and enables the <em>memreader</em> to perform its <em>read</em> operation. For good measure, the <em>memwriter</em> also unmaps the shared memory from the <em>memwriter</em> address space:
<pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token function">munmap</span><span class="token punctuation">(</span>memptr<span class="token punctuation">,</span> ByteSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* unmap the storage *
</span></code><button class="copy-code-button">Copy</button></pre>
  This bars the <em>memwriter</em> from further access to the shared memory.<br>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="Example 4. Source code for the _memreader_ process" dir="auto" class="heading" id="Example_4._Source_code_for_the__memreader__process"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Example 4. Source code for the <em>memreader</em> process</h3><div class="heading-children"><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token comment">/** Compilation: gcc -o memreader memreader.c -lrt -lpthread **/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;semaphore.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"shmem.h"</span></span>

<span class="token keyword">void</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">perror</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">shm_open</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">,</span> O_RDWR<span class="token punctuation">,</span> AccessPerms<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* empty to begin */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"Can't get file descriptor..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* get a pointer to memory */</span>
  <span class="token class-name">caddr_t</span> memptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span>       <span class="token comment">/* let system pick where to put segment */</span>
                        ByteSize<span class="token punctuation">,</span>   <span class="token comment">/* how many bytes */</span>
                        PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> <span class="token comment">/* access protections */</span>
                        MAP_SHARED<span class="token punctuation">,</span> <span class="token comment">/* mapping visible to other processes */</span>
                        fd<span class="token punctuation">,</span>         <span class="token comment">/* file descriptor */</span>
                        <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">/* offset: start at 1st byte */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">caddr_t</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> memptr<span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"Can't access segment..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* create a semaphore for mutual exclusion */</span>
  <span class="token class-name">sem_t</span><span class="token operator">*</span> semptr <span class="token operator">=</span> <span class="token function">sem_open</span><span class="token punctuation">(</span>SemaphoreName<span class="token punctuation">,</span> <span class="token comment">/* name */</span>
                           O_CREAT<span class="token punctuation">,</span>       <span class="token comment">/* create the semaphore */</span>
                           AccessPerms<span class="token punctuation">,</span>   <span class="token comment">/* protection perms */</span>
                           <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* initial value */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>semptr <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">report_and_exit</span><span class="token punctuation">(</span><span class="token string">"sem_open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* use semaphore as a mutex (lock) by waiting for writer to increment it */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">sem_wait</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* wait until semaphore != 0 */</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>MemContents<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token function">write</span><span class="token punctuation">(</span>STDOUT_FILENO<span class="token punctuation">,</span> memptr <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* one byte at a time */</span>
    <span class="token function">sem_post</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* cleanup */</span>
  <span class="token function">munmap</span><span class="token punctuation">(</span>memptr<span class="token punctuation">,</span> ByteSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sem_close</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">unlink</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">In both the <em>memwriter</em> and <em>memreader</em> programs, the shared-memory functions of main interest are <strong>shm_open</strong> and <strong>mmap</strong>: on success, the first call returns a file descriptor for the backing file, which the second call then uses to get a pointer to the shared memory segment. The calls to <strong>shm_open</strong> are similar in the two programs except that the <em>memwriter</em> program creates the shared memory, whereas the <em>memreader</em> only accesses this already created memory:</p></div><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">shm_open</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">,</span> O_RDWR <span class="token operator">|</span> O_CREAT<span class="token punctuation">,</span> AccessPerms<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* memwriter */</span>
<span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">shm_open</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">,</span> O_RDWR<span class="token punctuation">,</span> AccessPerms<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">/* memreader */</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">With a file descriptor in hand, the calls to <strong>mmap</strong> are the same:</p></div><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token class-name">caddr_t</span> memptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">The first argument to <strong>mmap</strong> is <strong>NULL</strong>, which means that the system determines where to allocate the memory in virtual address space. It's possible (but tricky) to specify an address instead. The <strong>MAP_SHARED</strong> flag indicates that the allocated memory is shareable among processes, and the last argument (in this case, zero) means that the offset for the shared memory should be the first byte. The <strong>size</strong> argument specifies the number of bytes to be allocated (in this case, 512), and the protection argument indicates that the shared memory can be written and read.</p></div><div><p dir="auto">When the <em>memwriter</em> program executes successfully, the system creates and maintains the backing file; on my system, the file is <em>/dev/shm/shMemEx</em>, with <em>shMemEx</em> as my name (given in the header file <em>shmem.h</em>) for the shared storage. In the current version of the <em>memwriter</em> and <em>memreader</em> programs, the statement:</p></div><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token function">shm_unlink</span><span class="token punctuation">(</span>BackingFile<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* removes backing file */</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">removes the backing file. If the <strong>unlink</strong> statement is omitted, then the backing file persists after the program terminates.</p></div><div><p dir="auto">The <em>memreader</em>, like the <em>memwriter</em>, accesses the semaphore through its name in a call to <strong>sem_open</strong>. But the <em>memreader</em> then goes into a wait state until the <em>memwriter</em> increments the semaphore, whose initial value is 0:</p></div><div><pre class="language-c" tabindex="0"><code class="language-c is-loaded"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">sem_wait</span><span class="token punctuation">(</span>semptr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* wait until semaphore != 0 */</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">Once the wait is over, the <em>memreader</em> reads the ASCII bytes from the shared memory, cleans up, and terminates.</p></div><div><p dir="auto">The shared-memory API includes operations explicitly to synchronize the shared memory segment and the backing file. These operations have been omitted from the example to reduce clutter and&nbsp;keep the&nbsp;focus on the memory-sharing and semaphore code.</p></div><div><p dir="auto">The <em>memwriter</em> and <em>memreader</em> programs are likely to execute without inducing a race condition even if the semaphore code is removed: the <em>memwriter</em> creates the shared memory segment and writes immediately to it; the <em>memreader</em> cannot even access the shared memory until this has been created. However, best practice requires that shared-memory access is synchronized whenever a <em>write</em> operation is in the mix, and the semaphore API is important enough to be highlighted in a code example.</p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="Wrapping up" dir="auto" class="heading" id="Wrapping_up"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Wrapping up</h2><div class="heading-children"><div><p dir="auto">The shared-file and shared-memory examples show how processes can communicate through <em>shared storage</em>, files in one case and memory segments in the other. The APIs for both approaches are relatively straightforward. Do these approaches have a common downside? Modern applications often deal with streaming data, indeed, with massively large streams of data. Neither the shared-file nor the shared-memory approaches are well suited for massive data streams. Channels of one type or another are better suited. Part 2 thus introduces channels and message queues, again with code examples in C.</p></div><div><p dir="auto"><strong>[<a data-tooltip-position="top" aria-label="https://opensource.com/downloads/guide-inter-process-communication-linux" rel="noopener" class="external-link" href="https://opensource.com/downloads/guide-inter-process-communication-linux" target="_blank">Download</a> the complete guide to inter-process communication in Linux]</strong></p></div><div><hr></div><div><p dir="auto">More Linux resources</p></div><div><ul>
<li data-line="0" dir="auto"><a data-tooltip-position="top" aria-label="https://developers.redhat.com/cheat-sheets/linux-commands-cheat-sheet/?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://developers.redhat.com/cheat-sheets/linux-commands-cheat-sheet/?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">Linux commands cheat sheet</a></li>
<li data-line="1" dir="auto"><a data-tooltip-position="top" aria-label="https://developers.redhat.com/cheat-sheets/advanced-linux-commands/?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://developers.redhat.com/cheat-sheets/advanced-linux-commands/?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">Advanced Linux commands cheat sheet</a></li>
<li data-line="2" dir="auto"><a data-tooltip-position="top" aria-label="https://www.redhat.com/en/services/training/rh024-red-hat-linux-technical-overview?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://www.redhat.com/en/services/training/rh024-red-hat-linux-technical-overview?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">Free online course: RHEL Technical Overview</a></li>
<li data-line="3" dir="auto"><a data-tooltip-position="top" aria-label="https://opensource.com/downloads/cheat-sheet-networking?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://opensource.com/downloads/cheat-sheet-networking?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">Linux networking cheat sheet</a></li>
<li data-line="4" dir="auto"><a data-tooltip-position="top" aria-label="https://opensource.com/downloads/cheat-sheet-selinux?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://opensource.com/downloads/cheat-sheet-selinux?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">SELinux cheat sheet</a></li>
<li data-line="5" dir="auto"><a data-tooltip-position="top" aria-label="https://opensource.com/downloads/linux-common-commands-cheat-sheet?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://opensource.com/downloads/linux-common-commands-cheat-sheet?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">Linux common commands cheat sheet</a></li>
<li data-line="6" dir="auto"><a data-tooltip-position="top" aria-label="https://opensource.com/resources/what-are-linux-containers?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://opensource.com/resources/what-are-linux-containers?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">What are Linux containers?</a></li>
<li data-line="7" dir="auto"><a data-tooltip-position="top" aria-label="https://opensource.com/tags/linux?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" rel="noopener" class="external-link" href="https://opensource.com/tags/linux?intcmp=70160000000h1jYAAQ&amp;utm_source=intcallout&amp;utm_campaign=linuxcontent" target="_blank">Our latest Linux articles</a></li>
</ul></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Inter-process communication in Linux -- Shared storage"><div class="tree-item-contents heading-link" heading-name="Inter-process communication in Linux -- Shared storage"><span class="tree-item-title">Inter-process communication in Linux -- Shared storage</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Core_concepts"><div class="tree-item-contents heading-link" heading-name="Core concepts"><span class="tree-item-title">Core concepts</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Shared_files"><div class="tree-item-contents heading-link" heading-name="Shared files"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Shared files</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Example_1._The__producer__program"><div class="tree-item-contents heading-link" heading-name="Example 1. The _producer_ program"><span class="tree-item-title">Example 1. The <em>producer</em> program</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Example_2._The__consumer__program"><div class="tree-item-contents heading-link" heading-name="Example 2. The _consumer_ program"><span class="tree-item-title">Example 2. The <em>consumer</em> program</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Shared_memory"><div class="tree-item-contents heading-link" heading-name="Shared memory"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Shared memory</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Example_3._Source_code_for_the__memwriter__process"><div class="tree-item-contents heading-link" heading-name="Example 3. Source code for the _memwriter_ process"><span class="tree-item-title">Example 3. Source code for the <em>memwriter</em> process</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Example_4._Source_code_for_the__memreader__process"><div class="tree-item-contents heading-link" heading-name="Example 4. Source code for the _memreader_ process"><span class="tree-item-title">Example 4. Source code for the <em>memreader</em> process</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="computer-science/operating-system/linux/inter-process-communication-in-linux-shared-storage.html#Wrapping_up"><div class="tree-item-contents heading-link" heading-name="Wrapping up"><span class="tree-item-title">Wrapping up</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>